

<!DOCTYPE html>
<html
  lang="en"
  dir="ltr"
  class="scroll-smooth"
  data-default-appearance="light"
  data-auto-appearance="true"
><head>
  <meta charset="utf-8" />
  
    <meta http-equiv="content-language" content="en" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  
  <title>Troubleshooting Docker &middot; Pen-y-Fan</title>
    <meta name="title" content="Troubleshooting Docker &middot; Pen-y-Fan" />
  
  
  
  
    <meta name="robots" content="all" />
  
  
  <link rel="canonical" href="https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/" />
  
  
  
  
  
  
  
  
  
  
  <link
    type="text/css"
    rel="stylesheet"
    href="/css/main.bundle.min.2a198fa5624ee1e740791878e7603321e05ce274c740ab7814cb3ac05da1f7b3a58f8377c3715cdf3bfb423acd3275b43658698b04fd8f4fe8275ea2c3e8409d.css"
    integrity="sha512-KhmPpWJO4edAeRh452AzIeBc4nTHQKt4FMs6wF2h97Olj4N3w3Fc3zv7QjrNMnW0NlhpiwT9j0/oJ16iw&#43;hAnQ=="
  />
  
  
  <script type="text/javascript" src="/js/appearance.min.badab316c9287a5a42a843e4eb45da65bb3d194a5a0f5fa4a3e516160e67df0b8c65f4f19a8e146436e29d583699e6cb41d6bbe99e05e1dbaa877763bad9f8e2.js" integrity="sha512-utqzFskoelpCqEPk60XaZbs9GUpaD1&#43;ko&#43;UWFg5n3wuMZfTxmo4UZDbinVg2mebLQda76Z4F4duqh3djutn44g=="></script>
  
  
    
    
  
  
  
    
    <script defer type="text/javascript" id="script-bundle" src="/js/main.bundle.min.9947db70e5b36e741e53f8531bd734741b3fc7a688f7b5d749fc5433c48efc252f47bdf44e471570a550fc051b87712799014040e6349b38d64448b94e84e45a.js" integrity="sha512-mUfbcOWzbnQeU/hTG9c0dBs/x6aI97XXSfxUM8SO/CUvR730TkcVcKVQ/AUbh3EnmQFAQOY0mzjWREi5ToTkWg==" data-copy="Copy" data-copied="Copied"></script>
  
  
  
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
    <link rel="manifest" href="/site.webmanifest" />
  
  
  
  
  
  
  
  <meta property="og:title" content="Troubleshooting Docker" />
<meta property="og:description" content="I have been using Docker since I installed Pop!_OS On my laptop Oct 2020. I deliberately have not installed PHP, MySQL or Apache on my laptop, which has forced me to learn to use Docker! The first tutorial I followed was the Docker docs get started after I installed Docker. I found this to be a useful introduction, even though I wanted a PHP environment, the guide still explained the basics of Docker." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-12T20:33:57+00:00" />
<meta property="article:modified_time" content="2021-02-12T20:33:57+00:00" /><meta property="og:site_name" content="Pen-y-Fan" />


  <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Troubleshooting Docker"/>
<meta name="twitter:description" content="I have been using Docker since I installed Pop!_OS On my laptop Oct 2020. I deliberately have not installed PHP, MySQL or Apache on my laptop, which has forced me to learn to use Docker! The first tutorial I followed was the Docker docs get started after I installed Docker. I found this to be a useful introduction, even though I wanted a PHP environment, the guide still explained the basics of Docker."/>

  
  <script type="application/ld+json">
  [{
    "@context": "https://schema.org",
    "@type": "Article",
    "articleSection": "Posts",
    "name": "Troubleshooting Docker",
    "headline": "Troubleshooting Docker",
    
    "abstract": "I have been using Docker since I installed Pop!_OS On my laptop Oct 2020. I deliberately have not installed PHP, MySQL or Apache on my laptop, which has forced me to learn to use Docker! The first tutorial I followed was the Docker docs get started after I installed Docker. I found this to be a useful introduction, even though I wanted a PHP environment, the guide still explained the basics of Docker.",
    "inLanguage": "en",
    "url" : "https:\/\/pen-y-fan.github.io\/2021\/02\/12\/Troubleshooting-Docker\/",
    "author" : {
      "@type": "Person",
      "name": "Michael Pritchard (AKA Pen-y-Fan)"
    },
    "copyrightYear": "2021",
    "dateCreated": "2021-02-12T20:33:57\u002b00:00",
    "datePublished": "2021-02-12T20:33:57\u002b00:00",
    
    "dateModified": "2021-02-12T20:33:57\u002b00:00",
    
    "keywords": ["Docker","Tutorial","Linux"],
    
    "mainEntityOfPage": "true",
    "wordCount": "3813"
  }]
  </script>


  
  <meta name="author" content="Michael Pritchard (AKA Pen-y-Fan)" />
  
    
      <link href="https://github.com/Pen-y-Fan" rel="me" />
    
      <link href="https://www.linkedin.com/in/michael-pritchard-340b4520/" rel="me" />
    
      <link href="https://www.reddit.com/user/Pen-y-Fan" rel="me" />
    
      <link href="https://twitter.com/MikeAPritch" rel="me" />
    
  
  
  






  
  
  
  


  
  
</head>
<body
    class="flex flex-col h-screen px-6 m-auto text-lg leading-7 bg-neutral text-neutral-900 sm:px-14 md:px-24 lg:px-32 dark:bg-neutral-800 dark:text-neutral max-w-7xl"
  >
    <div id="the-top" class="absolute flex self-center">
      <a
        class="px-3 py-1 text-sm -translate-y-8 rounded-b-lg bg-primary-200 dark:bg-neutral-600 focus:translate-y-0"
        href="#main-content"
        ><span class="font-bold ltr:pr-2 rtl:pl-2 text-primary-600 dark:text-primary-400"
          >&darr;</span
        >Skip to main content</a
      >
    </div>
    
    
      <header class="py-6 font-semibold sm:py-10 text-neutral-900 dark:text-neutral print:hidden">
  <nav class="flex justify-between">
    
    <div>
      
        
          <a href="/">
            <img
              src="/img/logo.jpg"
              width="51"
              height="64"
              class="max-w-[10rem] max-h-[10rem] object-scale-down object-left"
              alt="Pen-y-Fan"
            />
          </a>
        
      
      

    </div>
    
    
      <ul class="flex flex-col list-none ltr:text-right rtl:text-left sm:flex-row">
        
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/posts/"
                title="Posts"
                >Blog</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/tags/"
                title="Tags"
                >Tags</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="/about/"
                title="About"
                >About</a
              >
            </li>
          
            <li class="mb-1 sm:mb-0 ltr:sm:mr-7 ltr:sm:last:mr-0 rtl:sm:ml-7 rtl:sm:last:ml-0">
              <a
                class="decoration-primary-500 hover:underline hover:decoration-2 hover:underline-offset-2"
                href="https://github.com/Pen-y-Fan"
                title=""
                >GitHub</a
              >
            </li>
          
        
        
      </ul>
    
  </nav>
</header>

    
    <div class="relative flex flex-col grow">
      <main id="main-content" class="grow">
        
  <article>
    <header class="max-w-prose">
      
      <h1 class="mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">
        Troubleshooting Docker
      </h1>
      <div class="mt-8 mb-12 text-base text-neutral-500 dark:text-neutral-400 print:hidden">
        





  
  



  

  
  
    
  

  

  

  
    
  

  


  <div class="flex flex-row flex-wrap items-center">
    
    
      <time datetime="2021-02-12 20:33:57 &#43;0000 UTC">12 February 2021</time><span class="px-2 text-primary-500">&middot;</span><span title="Reading time">18 mins</span>
    

    
    
  </div>

  
  


      </div>
    </header>
    <section class="flex flex-col max-w-full mt-0 prose lg:flex-row dark:prose-invert">
      
        <div class="order-first px-0 lg:max-w-xs ltr:lg:pl-8 rtl:lg:pr-8 lg:order-last">
          <div class="ltr:pl-5 rtl:pr-5 toc lg:sticky lg:top-10 print:hidden">
            <details open class="mt-0 overflow-hidden rounded-lg rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5">
  <summary
    class="block py-1 text-lg font-semibold cursor-pointer rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 text-neutral-800 dark:text-neutral-100 lg:hidden bg-neutral-100 dark:bg-neutral-700"
  >
    Table of Contents
  </summary>
  <div
    class="py-2 border-dotted ltr:border-l rtl:border-r rtl:pr-5 ltr:pl-5 ltr:-ml-5 rtl:-mr-5 border-neutral-300 dark:border-neutral-600"
  >
    <nav id="TableOfContents">
  <ul>
    <li><a href="#so-what-is-the-blog-about">So what is the blog about?</a></li>
    <li><a href="#file-permissions">File permissions</a></li>
    <li><a href="#composer-docker-image">Composer Docker Image</a>
      <ul>
        <li><a href="#basic-usage">Basic usage</a></li>
        <li><a href="#fixing-filesystem-permissions">Fixing filesystem permissions</a></li>
        <li><a href="#install-composer-programmatically">Install composer programmatically</a></li>
        <li><a href="#possible-workarounds">Possible workarounds</a></li>
        <li><a href="#troubleshooting-composer">Troubleshooting Composer</a></li>
      </ul>
    </li>
    <li><a href="#example-dockerfile">Example Dockerfile</a></li>
    <li><a href="#how-to-create-a-project-from-within-a-docker-container">How to create a project from within a Docker container</a></li>
    <li><a href="#node-project">Node Project</a>
      <ul>
        <li><a href="#create-a-new-project">Create a new project</a></li>
        <li><a href="#requirements">Requirements</a></li>
        <li><a href="#setup">Setup</a></li>
        <li><a href="#docker-plan">Docker plan</a></li>
        <li><a href="#create-the-project">Create the project</a></li>
        <li><a href="#configure-docker-to-use-node">Configure Docker to use node</a></li>
        <li><a href="#add-hexo-globally">Add Hexo globally</a></li>
        <li><a href="#init-the-project-in-the-current-directory">init the project in the current directory</a></li>
        <li><a href="#add-hexo-as-a-project-dependency">Add Hexo as a project dependency</a></li>
        <li><a href="#reset-the-permissions">Reset the permissions</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
  </div>
</details>

          </div>
        </div>
      
      <div class="min-w-0 min-h-0 max-w-prose">
        <p>



  
  
    
  
  
    <figure>
      <img
        class="my-0 rounded-md"
        srcset="
          /2021/02/12/Troubleshooting-Docker/images/ines-mills-TGs0tHMk4eg-unsplash_hu0450c69133a242b1317f76c4c21d9c2a_761873_330x0_resize_q75_box.jpg 330w,
          /2021/02/12/Troubleshooting-Docker/images/ines-mills-TGs0tHMk4eg-unsplash_hu0450c69133a242b1317f76c4c21d9c2a_761873_660x0_resize_q75_box.jpg 660w,
          /2021/02/12/Troubleshooting-Docker/images/ines-mills-TGs0tHMk4eg-unsplash_hu0450c69133a242b1317f76c4c21d9c2a_761873_1024x0_resize_q75_box.jpg 1024w,
          /2021/02/12/Troubleshooting-Docker/images/ines-mills-TGs0tHMk4eg-unsplash_hu0450c69133a242b1317f76c4c21d9c2a_761873_1320x0_resize_q75_box.jpg 2x"
        src="/2021/02/12/Troubleshooting-Docker/images/ines-mills-TGs0tHMk4eg-unsplash_hu0450c69133a242b1317f76c4c21d9c2a_761873_660x0_resize_q75_box.jpg"
        alt="Containers arch"
      />
      <figcaption>Containers arch</figcaption>
    </figure>
  


Photo
by <a href="https://unsplash.com/@inesmills?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText%22">ines mills</a>
on <a href="https://unsplash.com/s/photos/shipping-container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a>
.</p>
<p>I have been using Docker since I installed <a href="../../2020/Pop-OS-new-install.md">Pop!_OS On my laptop Oct 2020</a>. I
deliberately have not installed PHP, MySQL or Apache on my laptop, which has forced me to learn to use Docker!</p>
<p>The first tutorial I followed was the Docker docs <a href="https://docs.docker.com/get-started/">get started</a> after I installed
Docker. I found this to be a useful introduction, even though I wanted a PHP environment, the guide still explained the
basics of Docker. I will not cover the basics here, as these are already well covered in the getting started
documentation, there are many youtube channels, some I have watched are:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=YFl2mCHdv24">Learn Docker in 12 Minutes üê≥</a> by Jake Wright</li>
<li><a href="https://www.youtube.com/watch?v=fqMOX6JJhGo">Docker Tutorial for Beginners - A Full DevOps Course on How to Run Applications in Containers</a>
by freeCodeCamp.org</li>
<li><a href="https://www.youtube.com/watch?v=Kyx2PsuwomE">Exploring Docker [1] - Getting Started</a> and</li>
<li><a href="https://www.youtube.com/watch?v=hP77Rua1E0c">Exploring Docker [2] - Docker Compose With Node &amp; MongoDB</a> by
Traversy Media.</li>
</ul>
<p>Brad Traversy has also published an excellent gist:</p>
<ul>
<li><a href="https://gist.github.com/bradtraversy/89fad226dc058a41b596d586022a9bd3">Docker Commands, Help &amp; Tips</a> with all the
basic commands!</li>
</ul>
<h2 id="so-what-is-the-blog-about" class="relative group">So what is the blog about? <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#so-what-is-the-blog-about" aria-label="Anchor">#</a></span></h2>
<p>What I want to cover are the parts beyond the basics.</p>
<ul>
<li>file permissions are one of my biggest problems</li>
<li>creating a development environment, with the tooling I want at my fingertips.</li>
</ul>
<h2 id="file-permissions" class="relative group">File permissions <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#file-permissions" aria-label="Anchor">#</a></span></h2>
<p>One of the first hurdles I came across was file permissions. This seems to be particularly on Linux. When the container
is launched, the default user is root. If any files are changed, the file system on the OS will be assigned to root!</p>
<p>For example, if we pull down a repository and want to spin up a docker container for
composer <code>docker run composer install</code>, however, the vendor folder will be created as root, along with all the files and
subfolders.</p>
<p>The initial workaround is to run <code>chown</code> from the host machine, e.g.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">sudo chown -R michael:michael ./vendor
</span></span><span class="line"><span class="cl"><span class="c1"># or</span>
</span></span><span class="line"><span class="cl">sudo chown -R <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> ./vendor
</span></span></code></pre></div><p><code>$(id -u):$(id -g)</code> is a way of getting the username and group of the signed-in user. e.g.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl"><span class="c1"># michael</span>
</span></span><span class="line"><span class="cl">id -u
</span></span><span class="line"><span class="cl"><span class="c1"># 1000</span>
</span></span><span class="line"><span class="cl">id -g
</span></span><span class="line"><span class="cl"><span class="c1"># 1000</span>
</span></span><span class="line"><span class="cl">id <span class="k">$(</span>whoami<span class="k">)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># uid=1000(michael) gid=1000(michael) groups=1000(michael),...</span>
</span></span></code></pre></div><p>Examples of options are uid:gid, this is normally 1000:1000, or user:group, in my case michael:michael. Further
reading <a href="https://kb.iu.edu/d/adwf">Find a user&rsquo;s UID or GID in Unix</a>. Further details
on <a href="https://jtreminio.com/blog/running-docker-containers-as-current-host-user/">Running Docker Containers as Current Host User</a>
.</p>
<h2 id="composer-docker-image" class="relative group">Composer Docker Image <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#composer-docker-image" aria-label="Anchor">#</a></span></h2>
<p>Composer is the dependency manager for PHP.</p>
<ul>
<li><a href="https://hub.docker.com/_/composer">Docker hub composer images</a></li>
</ul>
<h3 id="basic-usage" class="relative group">Basic usage <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#basic-usage" aria-label="Anchor">#</a></span></h3>
<p>The documentation has the following basic usage:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --rm --interactive --tty <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --volume <span class="nv">$PWD</span>:/app <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  composer install
</span></span></code></pre></div><p>The same command can be converted to the shorter syntax. By making it into one line, allowing easier copying and
pasting.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --rm -it -v <span class="nv">$PWD</span>:/app composer install
</span></span></code></pre></div><p>An explanation for the command line:</p>
<ul>
<li><code>docker run</code> runs a new instance of a docker image creating a container</li>
<li><a href="https://docs.docker.com/engine/reference/run/#clean-up---rm">Clean up (&ndash;rm)</a> automatically clean up the container
and remove the file system when the container exits, <strong>Note</strong> the <strong>double</strong> minus in <code>--rm</code>!</li>
<li><a href="https://docs.docker.com/engine/reference/run/#foreground">&ndash;interactive &ndash;tty / -i -t / -it</a> For interactive
processes (like a shell), you must use -i -t together to allocate a tty for the container process. -i -t is
often written -it</li>
<li><a href="https://docs.docker.com/engine/reference/run/#volume-shared-filesystems">&ndash;volume / -v $PWD:/app</a> Bind the host file
system to the destination, $PWD is the current working directory, /app is the destination directory. On Windows it
should be the full path name e.g. c:/laragon/www/php-project</li>
<li><code>composer</code> the image to be run</li>
<li><code>install</code> is the command to run inside the docker container. This can be any composer command!</li>
</ul>
<p>For more details please see the <a href="https://docs.docker.com/engine/reference/run/">Docker run reference</a>.</p>
<h3 id="fixing-filesystem-permissions" class="relative group">Fixing filesystem permissions <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#fixing-filesystem-permissions" aria-label="Anchor">#</a></span></h3>
<p>By default, Composer runs as root inside the container. This can lead to permission issues on your host filesystem. You
can work around this by running the container under the signed-in user:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --rm --interactive --tty <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --volume <span class="nv">$PWD</span>:/app <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  --user <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>  composer install
</span></span></code></pre></div><p>Again the short, but slightly less readably syntax, can be used to make one line version, with some example commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker run --rm -it -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer install
</span></span><span class="line"><span class="cl">docker run --rm -it -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer update
</span></span><span class="line"><span class="cl">docker run --rm -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer <span class="nb">test</span>
</span></span><span class="line"><span class="cl">docker run --rm -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer check-cs
</span></span><span class="line"><span class="cl">docker run --rm -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer phpstan
</span></span></code></pre></div><p>You may notice, install and update have an interactive terminal -it. The test, check-cs and phpstan do not. Sometimes
Composer asks questions, which need user input, to run tests and lint code this is not required.</p>
<p>The composer config file <strong>composer.json</strong> would contain the scripts for <strong>test</strong>, <strong>check-cs</strong> and <strong>phpstan</strong> e.g.:</p>
<p><strong>composer.json</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;test&#34;</span><span class="p">:</span> <span class="s2">&#34;phpunit&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;check-cs&#34;</span><span class="p">:</span> <span class="s2">&#34;ecs check --ansi&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;phpstan&#34;</span><span class="p">:</span> <span class="s2">&#34;phpstan analyse --ansi&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>The command is similar, as explained above, with -u or &ndash;user added:</p>
<ul>
<li><a href="https://docs.docker.com/engine/reference/run/#user">&ndash;user or -u</a> Sets the username or UID used and optionally the
group name or GID for the specified command</li>
<li><code>$(id -u):$(id -g)</code> is a way of getting the username and group of the signed-in user. e.g.</li>
</ul>
<p>This is required on Linux. The OS and docker container share the same file system. The docker container will normally
run under user 0, root user, meaning any files written to the shared volume by the container, will be created by the
root user.</p>
<h3 id="install-composer-programmatically" class="relative group">Install composer programmatically <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#install-composer-programmatically" aria-label="Anchor">#</a></span></h3>
<p>Sometimes Composer will not run the <strong>install</strong> command:</p>
<ul>
<li>Composer doesn&rsquo;t have the correct dependencies</li>
<li>Composer isn&rsquo;t the correct version of PHP.</li>
</ul>
<p>For example, if I try to install Silverstripe, which needs the PHP <strong>intl</strong> extension:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">git clone git@github.com:Pen-y-Fan/silverstripe-lessons.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> silverstripe-lessons
</span></span><span class="line"><span class="cl">docker run --rm -it -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer install
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Your requirements could not be resolved to an installable set of packages.
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  Problem 1
</span></span><span class="line"><span class="cl">    - Installation request for silverstripe/framework 4.5.2 -&gt; satisfiable by 
</span></span><span class="line"><span class="cl">      silverstripe/framework[4.5.2].
</span></span><span class="line"><span class="cl">    - silverstripe/framework 4.5.2 requires ext-intl * -&gt; the requested PHP 
</span></span><span class="line"><span class="cl">      extension intl is missing from your system.
</span></span><span class="line"><span class="cl">  Problem 2
</span></span><span class="line"><span class="cl">    - silverstripe/framework 4.5.2 requires ext-intl * -&gt; the requested PHP 
</span></span><span class="line"><span class="cl">      extension intl is missing from your system.
</span></span><span class="line"><span class="cl">    - silverstripe/versioned-admin 1.3.1 requires silverstripe/framework ^4.5 -&gt; 
</span></span><span class="line"><span class="cl">      satisfiable by silverstripe/framework[4.5.2].
</span></span><span class="line"><span class="cl">    - Installation request for silverstripe/versioned-admin 1.3.1 -&gt; satisfiable 
</span></span><span class="line"><span class="cl">      by silverstripe/versioned-admin[1.3.1].
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  To enable extensions, verify that they are enabled in your .ini files:
</span></span><span class="line"><span class="cl">    - /usr/local/etc/php/php-cli.ini
</span></span><span class="line"><span class="cl">    - /usr/local/etc/php/conf.d/docker-php-ext-sodium.ini
</span></span><span class="line"><span class="cl">    - /usr/local/etc/php/conf.d/docker-php-ext-zip.ini
</span></span><span class="line"><span class="cl">  You can also run `php --ini` inside terminal to see which files are used by PHP
</span></span><span class="line"><span class="cl">  in CLI mode.
</span></span></code></pre></div><p>Likewise as more project become php8 only, for example:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">git clone git@github.com:Pen-y-Fan/hello-world-php8.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> hello-world-php8
</span></span><span class="line"><span class="cl">docker run --rm -it -v <span class="nv">$PWD</span>:/app -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> composer install
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Fatal error: Uncaught ParseError: syntax error, unexpected &#39;:&#39;, expecting &#39;)&#39; in 
</span></span><span class="line"><span class="cl">/app/tests/HelloWorldTest.php:14
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Or
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Fatal error: Composer detected issues in your platform: Your Composer dependencies 
</span></span><span class="line"><span class="cl">require a PHP version &#34;&gt;= 8.0.0&#34;. You are running 7.4.14. in 
</span></span><span class="line"><span class="cl">/app/vendor/composer/platform_check.php on line 24
</span></span></code></pre></div><h3 id="possible-workarounds" class="relative group">Possible workarounds <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#possible-workarounds" aria-label="Anchor">#</a></span></h3>
<p>One workaround is to spin-up the version of PHP required, with the extensions and programmatically add Composer.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="nv">DOCKER_HOME</span><span class="o">=</span>~/tmp
</span></span><span class="line"><span class="cl"><span class="nv">EXPECTED_CHECKSUM</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>wget -q -O - https://composer.github.io/installer.sig<span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">php -r <span class="s2">&#34;copy(&#39;https://getcomposer.org/installer&#39;, &#39;composer-setup.php&#39;);&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nv">ACTUAL_CHECKSUM</span><span class="o">=</span><span class="s2">&#34;</span><span class="k">$(</span>php -r <span class="s2">&#34;echo hash_file(&#39;sha384&#39;, &#39;composer-setup.php&#39;);&#34;</span><span class="k">)</span><span class="s2">&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="o">[</span> <span class="s2">&#34;</span><span class="nv">$EXPECTED_CHECKSUM</span><span class="s2">&#34;</span> !<span class="o">=</span> <span class="s2">&#34;</span><span class="nv">$ACTUAL_CHECKSUM</span><span class="s2">&#34;</span> <span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">then</span>
</span></span><span class="line"><span class="cl">    &gt;<span class="p">&amp;</span><span class="m">2</span> <span class="nb">echo</span> <span class="s1">&#39;ERROR: Invalid installer checksum&#39;</span>
</span></span><span class="line"><span class="cl">    rm composer-setup.php
</span></span><span class="line"><span class="cl">    <span class="nb">exit</span> <span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="k">fi</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">php composer-setup.php --quiet --install-dir<span class="o">=</span>/usr/local/bin/ --filename<span class="o">=</span>composer
</span></span><span class="line"><span class="cl"><span class="nv">RESULT</span><span class="o">=</span><span class="nv">$?</span>
</span></span><span class="line"><span class="cl">rm composer-setup.php
</span></span><span class="line"><span class="cl"><span class="c1"># smoke test</span>
</span></span><span class="line"><span class="cl">composer --version
</span></span><span class="line"><span class="cl"><span class="nb">exit</span> <span class="nv">$RESULT</span>
</span></span></code></pre></div><ul>
<li></li>
</ul>
<h3 id="troubleshooting-composer" class="relative group">Troubleshooting Composer <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#troubleshooting-composer" aria-label="Anchor">#</a></span></h3>
<p>The <a href="https://hub.docker.com/_/composer/">Composer Docker hub documentation</a> also has the following suggestions:</p>
<ul>
<li><strong>optimal</strong> create your image and install Composer inside it.</li>
</ul>
<p><strong>Note:</strong> Docker 17.05 introduced multi-stage builds, simplifying this enormously:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-dockerfile" data-lang="dockerfile"><span class="line"><span class="cl"><span class="k">COPY</span> --from<span class="o">=</span>composer /usr/bin/composer /usr/bin/composer<span class="err">
</span></span></span></code></pre></div><ul>
<li><strong>alternatively</strong> specify the target platform / extension(s) in your composer.json:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;config&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;platform&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;php&#34;</span><span class="p">:</span> <span class="s2">&#34;MAJOR.MINOR.PATCH&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;ext-something&#34;</span><span class="p">:</span> <span class="s2">&#34;MAJOR.MINOR.PATCH&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li><strong>discouraged</strong> pass the &ndash;ignore-platform-reqs and / or &ndash;no-scripts flags to install or update:</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker run --rm --interactive --tty <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>--volume <span class="nv">$PWD</span>:/app <span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span>composer install --ignore-platform-reqs --no-scripts
</span></span></code></pre></div><h2 id="example-dockerfile" class="relative group">Example Dockerfile <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#example-dockerfile" aria-label="Anchor">#</a></span></h2>
<p>The docker image for the Silverstripe CMS has extensions like <strong>tidy</strong> and <strong>intl</strong> enabled. The Composer image doesn&rsquo;t!
This Dockerfile will copy Composer into the Silverstripe image.</p>
<p><strong>Dockerfile</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">FROM brettt89/silverstripe-web:7.4-apache
</span></span><span class="line"><span class="cl">COPY --from<span class="o">=</span>composer /usr/bin/composer /usr/bin/composer
</span></span><span class="line"><span class="cl">RUN composer self-update --2
</span></span></code></pre></div><p>The <strong>docker-compose.yml</strong> file would something like:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s2">&#34;3.3&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">silverstripe</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">build</span><span class="p">:</span><span class="w"> </span><span class="l">.</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="c"># image: brettt89/silverstripe-web:7.4-apache</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;8081:80&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">.:/var/www/html</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">depends_on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">database</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">DOCUMENT_ROOT=/var/www/html/public</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_TRUSTED_PROXY_IPS=*</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_ENVIRONMENT_TYPE=dev</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_DATABASE_SERVER=database</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_DATABASE_NAME=SS_mysite</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_DATABASE_USERNAME=root</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_DATABASE_PASSWORD=</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_DEFAULT_ADMIN_USERNAME=admin</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">SS_DEFAULT_ADMIN_PASSWORD=password</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">database</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">mysql:5.7</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;33060:3306&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">MYSQL_ALLOW_EMPTY_PASSWORD=yes</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">db-data:/var/lib/mysql</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">db-data</span><span class="p">:</span><span class="w">
</span></span></span></code></pre></div><p>Once the <code>docker-compose up -d</code> is run, to spin up the containers. The <strong>silverstripe</strong> container will have Composer
installed. This can be accessed from the terminal within the running container:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker-compose <span class="nb">exec</span> -it -u <span class="k">$(</span>id -u<span class="k">)</span>:<span class="k">$(</span>id -g<span class="k">)</span> silverstripe composer install 
</span></span></code></pre></div><h2 id="how-to-create-a-project-from-within-a-docker-container" class="relative group">How to create a project from within a Docker container <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#how-to-create-a-project-from-within-a-docker-container" aria-label="Anchor">#</a></span></h2>
<p>Sometimes new projects need to be created from the command line, for example using <code>composer create-project</code>. This is
before the project folder has been created, therefore <strong>docker-compose.yml</strong> can not be created, in the project folder.
This is a chicken and egg situation. The project can&rsquo;t be started without the tooling, and the tooling can&rsquo;t be spun up
without a project folder.</p>
<p>The solution, with <code>composer create-project</code> at least it to create the project folder, spin up the environment, then
create the project in the same folder.</p>
<p>Navigate to your normal project root e.g.:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ~/PhpstormProjects/
</span></span><span class="line"><span class="cl">mkdir ./silverstripe-demo
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ./silverstripe-demo
</span></span><span class="line"><span class="cl">touch ./Dockerfile
</span></span><span class="line"><span class="cl">touch ./docker-compose.yml
</span></span><span class="line"><span class="cl">touch ./Makefile
</span></span><span class="line"><span class="cl">phpstorm .
</span></span></code></pre></div><p>This will:</p>
<ul>
<li>create the required directory</li>
<li>add empty Dockerfile, docker-compose.yml and Makefile</li>
<li>start PhpStorm</li>
</ul>
<p>Now PhpStorm is launched its starting to feel like we are working on a project. The Dockerfile from above can be pasted
in the Dockerfile, as can the docker-compose.yml from above in its corresponding file. That leaves us the Makefile.</p>
<p>Makefiles are a simple way to run shell scripts, like batch files in Windows, except there can be several scripts which
can be called by their key. For example:</p>
<p><strong>Makefile</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Set UID to your user ID. To check your user ID run `echo $(id -u)`</span>
</span></span><span class="line"><span class="cl"><span class="nv">UID</span> <span class="o">=</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Usage:</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make up - starts the docker-compose in the same directory in demon (background)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make down - stops the docker-compose</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell - opens a bash terminal inside the Silverstripe container as a standard user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell-root -  opens a bash in Silverstripe container as the root user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell-web -  opens a bash in Silverstripe container as www-data user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make up-f - start the docker-compose in the foreground (useful for error messages)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">up:
</span></span><span class="line"><span class="cl">	docker-compose up --build --remove-orphans -d
</span></span><span class="line"><span class="cl">up-f:
</span></span><span class="line"><span class="cl">	docker-compose up --build --remove-orphans
</span></span><span class="line"><span class="cl">down:
</span></span><span class="line"><span class="cl">	docker-compose down --remove-orphans
</span></span><span class="line"><span class="cl">shell:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> silverstripe bash
</span></span><span class="line"><span class="cl">shell-run:
</span></span><span class="line"><span class="cl">	docker-compose run -rm -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> silverstripe bash
</span></span><span class="line"><span class="cl">shell-root:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u 0:0 silverstripe bash
</span></span><span class="line"><span class="cl">shell-web:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u 33:33 silverstripe bash
</span></span><span class="line"><span class="cl">.PHONY : tests
</span></span><span class="line"><span class="cl">tests:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe vendor/bin/phpunit
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe chown -R <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> ./
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe chown -R 33:33 ./public/
</span></span><span class="line"><span class="cl">lint:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> silverstripe vendor/bin/phpcs app/src app/tests
</span></span><span class="line"><span class="cl">lint-clean:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> silverstripe vendor/bin/phpcbf app/src app/tests
</span></span><span class="line"><span class="cl">flush:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe vendor/bin/phpunit app/tests <span class="s1">&#39;&#39;</span> <span class="nv">flush</span><span class="o">=</span><span class="m">1</span>
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe chown -R <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> ./
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe chown -R 33:33 ./public/
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">chown:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe chown -R <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> ./
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> silverstripe chown -R 33:33 ./public/
</span></span></code></pre></div><p>You can see the Makefile contains the standard docker-compose commands, as you would normally run from the command line.
These work closely with the <strong>docker-compose.yml</strong> file to run the required commands. The make commands can be run
using <code>make</code> and the required key.</p>
<p>Normally, the container is up, therefore we can <strong>exec</strong> into the running container. Before we start the project we need
to <strong>run</strong> the container using bash, which will allow access to Composer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">make shell-run
</span></span></code></pre></div><p>From within the docker container, we now have Composer:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># I have no name!@b8a8ee52a81b:/var/www/html$ </span>
</span></span><span class="line"><span class="cl">composer --version
</span></span><span class="line"><span class="cl"><span class="c1"># Composer version 2.0.9 2021-01-27 16:09:27</span>
</span></span></code></pre></div><p>It would be easier to create the project in this folder, unfortunately, Composer will not allow it, as the folder is not
empty:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">composer create-project silverstripe/installer .
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">// ...
</span></span><span class="line"><span class="cl">Creating a &#34;silverstripe/installer&#34; project at &#34;./&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">                                                     
</span></span><span class="line"><span class="cl">  [InvalidArgumentException]                         
</span></span><span class="line"><span class="cl">  Project directory &#34;/var/www/html/.&#34; is not empty.  
</span></span><span class="line"><span class="cl">    
</span></span></code></pre></div><p>We, therefore, need to create the project, in a temp child folder. Then move it to this folder once run:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">composer create-project silverstripe/installer temp
</span></span><span class="line"><span class="cl"><span class="c1"># once installed move the temp folder:</span>
</span></span><span class="line"><span class="cl">mv ./temp/* ./
</span></span><span class="line"><span class="cl">ls -l
</span></span></code></pre></div><p>You should see output like this:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">-rw-rw-r--  1     1000     1000    128 Feb 14 09:42 Dockerfile
</span></span><span class="line"><span class="cl">-rw-rw-r--  1     1000     1000   1538 Feb 14 09:34 Makefile
</span></span><span class="line"><span class="cl">-rw-r--r--  1     1000     1000   3019 Feb 14 12:23 README.md
</span></span><span class="line"><span class="cl">drwxr-xr-x  4     1000     1000   4096 Feb 14 09:57 app
</span></span><span class="line"><span class="cl">-rw-r--r--  1     1000     1000   1055 Feb 14 09:57 composer.json
</span></span><span class="line"><span class="cl">-rw-r--r--  1     1000     1000 163329 Feb 14 09:57 composer.lock
</span></span><span class="line"><span class="cl">-rw-rw-r--  1     1000     1000    730 Feb 14 09:40 docker-compose.yml
</span></span><span class="line"><span class="cl">-rw-r--r--  1     1000     1000    876 Feb 14 09:56 phpcs.xml.dist
</span></span><span class="line"><span class="cl">drwxr-xr-x  4     1000     1000   4096 Feb 14 09:57 public
</span></span><span class="line"><span class="cl">drwxr-xr-x  2     1000     1000   4096 Feb 14 10:09 temp
</span></span><span class="line"><span class="cl">drwxr-xr-x  3     1000     1000   4096 Feb 14 09:57 themes
</span></span><span class="line"><span class="cl">drwxr-xr-x 27     1000     1000   4096 Feb 14 09:57 vendor
</span></span><span class="line"><span class="cl">-rw-r--r--  1     1000     1000   1002 Feb 14 09:56 web.config
</span></span></code></pre></div><p>If so, it is safe to delete the temp directory and exit the container</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">rm -dfr ./temp/
</span></span><span class="line"><span class="cl"><span class="nb">exit</span>
</span></span></code></pre></div><p>Hopefully, the project can be started:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">make up
</span></span></code></pre></div><p>Once up the Silverstripe app will run, in <strong>detached mode</strong>, it can be accessed on <a href="localhost:8081">localhost:8081</a>, however, we see a
browser error:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="o">[</span>Warning<span class="o">]</span> chmod<span class="o">()</span>: Operation not permitted
</span></span><span class="line"><span class="cl">GET /dev/build
</span></span><span class="line"><span class="cl">Line <span class="m">368</span> in /var/www/html/vendor/league/flysystem/src/Adapter/Local.php
</span></span></code></pre></div><p>This is a known problem, which can be easily fixed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">make chown
</span></span><span class="line"><span class="cl"><span class="c1"># docker-compose exec silverstripe chown -R 1000:1000 ./</span>
</span></span><span class="line"><span class="cl"><span class="c1"># docker-compose exec silverstripe chown -R 33:33 ./public/</span>
</span></span></code></pre></div><p>As you can see from the output, the permissions are reset on the root folder (/app) to the id of the signed-in user and
33:33 (www-data:www-data) is given access to /app/public.</p>
<p>Refresh the webpage. The site will build!</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Environment Builder
</span></span><span class="line"><span class="cl">http://localhost:8081/
</span></span><span class="line"><span class="cl">dev ‚Üí build
</span></span><span class="line"><span class="cl">Building database using SilverStripe\ORM\Connect\MySQL 5.7.31
</span></span><span class="line"><span class="cl">Creating database
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Creating database tables
</span></span><span class="line"><span class="cl">* File
</span></span><span class="line"><span class="cl">* Table File: created
</span></span><span class="line"><span class="cl">* Field File.ID: created as int(11) not null auto_increment
</span></span><span class="line"><span class="cl">...
</span></span></code></pre></div><p>Navigate to <a href="http://localhost:8081/">http://localhost:8081/</a> and the base site will display, or <a href="http://localhost:8081/admin">http://localhost:8081/admin</a> and sign in to the
CMS using the username and password set in the <strong>docker-compose.yml</strong>:</p>
<ul>
<li>SS_DEFAULT_ADMIN_USERNAME=<strong>admin</strong></li>
<li>SS_DEFAULT_ADMIN_PASSWORD=<strong>password</strong></li>
</ul>
<p>



  
  
    
  
  
    <figure>
      <img
        class="my-0 rounded-md"
        srcset="
          /2021/02/12/Troubleshooting-Docker/images/silverstripe-hello-world_huffce4d321c4932031628ceea79ba4494_40441_330x0_resize_box_3.png 330w,
          /2021/02/12/Troubleshooting-Docker/images/silverstripe-hello-world_huffce4d321c4932031628ceea79ba4494_40441_660x0_resize_box_3.png 660w,
          /2021/02/12/Troubleshooting-Docker/images/silverstripe-hello-world_huffce4d321c4932031628ceea79ba4494_40441_1024x0_resize_box_3.png 1024w,
          /2021/02/12/Troubleshooting-Docker/images/silverstripe-hello-world_huffce4d321c4932031628ceea79ba4494_40441_1320x0_resize_box_3.png 2x"
        src="/2021/02/12/Troubleshooting-Docker/images/silverstripe-hello-world_huffce4d321c4932031628ceea79ba4494_40441_660x0_resize_box_3.png"
        alt="Hexo hello word demo"
      />
      <figcaption>Hexo hello word demo</figcaption>
    </figure>
  

</p>
<h2 id="node-project" class="relative group">Node Project <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#node-project" aria-label="Anchor">#</a></span></h2>
<p>As promised at the start of the blog we will now create a node project, as the methods are the same as the Silverstripe
project I will only explain the differences. We will use this Hexo static content generator as an example. I am running
it now, with Docker.</p>
<h3 id="create-a-new-project" class="relative group">Create a new project <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#create-a-new-project" aria-label="Anchor">#</a></span></h3>
<p>We will go through the <a href="https://hexo.io/docs/">Hexo documentation</a> and convert it to a Docker environment:</p>
<h3 id="requirements" class="relative group">Requirements <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#requirements" aria-label="Anchor">#</a></span></h3>
<p>Installing Hexo is relatively easy and only requires the following beforehand:</p>
<ul>
<li>Node.js (Should be at least Node.js 10.13, recommends 12.0 or higher)
<ul>
<li>We can use Docker</li>
</ul>
</li>
<li>Git
<ul>
<li>We can use Docker</li>
</ul>
</li>
</ul>
<p>Install Hexo globally <code>npm install -g hexo-cli</code> or per project <code>npm install hexo</code> - This can be done inside a node
container.</p>
<h3 id="setup" class="relative group">Setup <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#setup" aria-label="Anchor">#</a></span></h3>
<p>The instructions are:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">hexo init &lt;folder&gt;
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> &lt;folder&gt;
</span></span><span class="line"><span class="cl">npm install
</span></span></code></pre></div><h3 id="docker-plan" class="relative group">Docker plan <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#docker-plan" aria-label="Anchor">#</a></span></h3>
<p>The setup has the same problem as Silverstripe. You need to install Hexo before you can <strong>init</strong> a project, the
workaround is therefore similar. We need a node image, globally install hexo, init the project then we can cd to the
project. Like Silverstripe we can:</p>
<ul>
<li>create the project</li>
<li>configure Docker to use node</li>
<li>Add Hexo globally</li>
<li>init the project in the current directory</li>
<li>Add Hexo as a project dependency</li>
<li>reset the permissions</li>
</ul>
<h3 id="create-the-project" class="relative group">Create the project <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#create-the-project" aria-label="Anchor">#</a></span></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="nb">cd</span> ~/PhpstormProjects/
</span></span><span class="line"><span class="cl">mkdir ./hexo-demo
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ./hexo-demo
</span></span><span class="line"><span class="cl">touch ./docker-compose.yml
</span></span><span class="line"><span class="cl">touch ./Makefile
</span></span><span class="line"><span class="cl">phpstorm .
</span></span></code></pre></div><h3 id="configure-docker-to-use-node" class="relative group">Configure Docker to use node <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#configure-docker-to-use-node" aria-label="Anchor">#</a></span></h3>
<p>We can now create the <strong>docker-compose.yml</strong> for Docker and <strong>Makefile</strong> files</p>
<p><strong>docker-compose.yml</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">services</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">server</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">node:12.18.4-alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">yarn server</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l">/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">.:/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">ports</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="s2">&#34;4000:4000&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">generate</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l">node:12.18.4-alpine</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l">yarn build</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">working_dir</span><span class="p">:</span><span class="w"> </span><span class="l">/app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">volumes</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">.:/app</span><span class="w">
</span></span></span></code></pre></div><p><strong>Makefile</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1"># Set UID to your user ID. To check your user ID run `echo $(id -u)`</span>
</span></span><span class="line"><span class="cl"><span class="nv">UID</span> <span class="o">=</span> <span class="m">1000</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Usage:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># make up - starts the docker-compose in the same directory in demon (background)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make up-f - start the docker-compose in the foreground (useful for error messages)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make down - stops the docker-compose</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make server - same as make up</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make generate - runs hexo generate as the standard user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make build - alias to make generate</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell - opens a shell terminal in the running node container as a standard user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell-run - starts a new container as a standard user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell-root - opens a shell terminal in the running node container as a root user</span>
</span></span><span class="line"><span class="cl"><span class="c1"># make shell-root-run - starts a new container as a root user </span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># make chown - runs chown, as the root user to reset the ownership of all folders to the UID</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">up:
</span></span><span class="line"><span class="cl">	docker-compose up --build --remove-orphans -d server
</span></span><span class="line"><span class="cl">up-f:
</span></span><span class="line"><span class="cl">	docker-compose up --build --remove-orphans server
</span></span><span class="line"><span class="cl">down:
</span></span><span class="line"><span class="cl">	docker-compose down --remove-orphans
</span></span><span class="line"><span class="cl">server:
</span></span><span class="line"><span class="cl">	docker-compose up --build --remove-orphans -d server
</span></span><span class="line"><span class="cl">generate:
</span></span><span class="line"><span class="cl">	docker-compose run -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> --rm generate
</span></span><span class="line"><span class="cl">build:
</span></span><span class="line"><span class="cl">	docker-compose run -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> --rm generate
</span></span><span class="line"><span class="cl">hexo:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> server npx hexo new <span class="k">$(</span>new<span class="k">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">shell:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> server /bin/sh
</span></span><span class="line"><span class="cl">shell-root:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u 0:0 server /bin/sh
</span></span><span class="line"><span class="cl">shell-run:
</span></span><span class="line"><span class="cl">	docker-compose run -u <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> server /bin/sh
</span></span><span class="line"><span class="cl">shell-root-run:
</span></span><span class="line"><span class="cl">	docker-compose run -u 0:0 server /bin/sh
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">chown:
</span></span><span class="line"><span class="cl">	docker-compose <span class="nb">exec</span> -u 0:0 server chown -R <span class="si">${</span><span class="nv">shell</span><span class="p"> id -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">shell</span><span class="p"> id -g</span><span class="si">}</span> ./
</span></span></code></pre></div><p>You can see many similarities with the setup, even though they are completely different projects, the methods to start,
stop and access are the same. This gives a consistent environment between projects.</p>
<p>You may be wondering why we are using node 12. As of Feb 2021, if you run Hexo with node 14, you will see an
error: <a href="https://github.com/hexojs/hexo/issues/4257">Regression in Node 14</a>, therefore the <strong>composer-compose.yml</strong> has
been configured to use Node 12 until this is resolved. This is an excellent example of why Docker is so powerful, if
Node 14, the LTS version, was locally installed this would be a problem!</p>
<h3 id="add-hexo-globally" class="relative group">Add Hexo globally <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#add-hexo-globally" aria-label="Anchor">#</a></span></h3>
<p>This is a temporary step, to allow the project to be initialised:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">make shell-root-run
</span></span><span class="line"><span class="cl"><span class="c1"># /app # </span>
</span></span><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl"><span class="c1"># root</span>
</span></span><span class="line"><span class="cl">npm install -g hexo-cli
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="c1"># + hexo-cli@4.2.0</span>
</span></span><span class="line"><span class="cl"><span class="c1"># added 65 packages from 339 contributors in 4.852s</span>
</span></span></code></pre></div><p>Keep the node container running and open a new terminal</p>
<h3 id="init-the-project-in-the-current-directory" class="relative group">init the project in the current directory <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#init-the-project-in-the-current-directory" aria-label="Anchor">#</a></span></h3>
<p>With a new terminal open, we can exec in the same running container, except this time as a stand user, reducing the
problem with file permissions.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">docker ps
</span></span><span class="line"><span class="cl"><span class="c1"># CONTAINER ID        IMAGE                ...  NAMES</span>
</span></span><span class="line"><span class="cl"><span class="c1"># e6ce46b15845        node:12.18.4-alpine  ...  hexo-demo_server_run_2746d359d723</span>
</span></span><span class="line"><span class="cl"><span class="c1"># note the name of your server (hexo-demo_server_run_2746d359d723) and replace it below:</span>
</span></span><span class="line"><span class="cl">docker <span class="nb">exec</span> -u <span class="si">${</span><span class="nv">id</span><span class="p"> -u</span><span class="si">}</span>:<span class="si">${</span><span class="nv">id</span><span class="p"> -g</span><span class="si">}</span> -it hexo-demo_server_run_2746d359d723 /bin/sh
</span></span><span class="line"><span class="cl"><span class="c1"># /app # </span>
</span></span><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl"><span class="c1"># node</span>
</span></span><span class="line"><span class="cl">hexo init temp
</span></span><span class="line"><span class="cl"><span class="c1"># INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span>
</span></span><span class="line"><span class="cl"><span class="c1"># WARN  git clone failed. Copying data instead</span>
</span></span><span class="line"><span class="cl"><span class="c1"># FATAL {</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span></code></pre></div><p>Ok, so we need git! Good job the other terminal is still open and running as root. Switch terminals:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="c1"># /app </span>
</span></span><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl"><span class="c1"># root</span>
</span></span><span class="line"><span class="cl">apk update <span class="o">&amp;&amp;</span> apk add git
</span></span><span class="line"><span class="cl"><span class="c1"># ...</span>
</span></span><span class="line"><span class="cl"><span class="c1"># (6/6) Installing git (2.24.3-r0)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Executing busybox-1.31.1-r9.trigger</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Executing ca-certificates-20191127-r2.trigger</span>
</span></span><span class="line"><span class="cl"><span class="c1"># OK: 23 MiB in 22 packages</span>
</span></span></code></pre></div><p>Now git has been installed in the running node container we can switch back to the stand node account and try again</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">whoami
</span></span><span class="line"><span class="cl"><span class="c1"># node</span>
</span></span><span class="line"><span class="cl">hexo init temp
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git
</span></span><span class="line"><span class="cl">INFO  Install dependencies
</span></span><span class="line"><span class="cl">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; urix@0.1.0: Please ...
</span></span><span class="line"><span class="cl">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve ...
</span></span><span class="line"><span class="cl">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve ...
</span></span><span class="line"><span class="cl">warning Your current version of Yarn is out of date. The latest version is ...
</span></span><span class="line"><span class="cl">INFO  Start blogging with Hexo!
</span></span></code></pre></div><p>Next temp directory can be moved:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">mv ./temp/* .
</span></span><span class="line"><span class="cl">ls -l
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">total 88
</span></span><span class="line"><span class="cl">-rw-rw-r--    1 node     node          1316 Feb 14 13:25 Makefile
</span></span><span class="line"><span class="cl">-rw-r--r--    1 node     node             0 Feb 14 14:19 _config.landscape.yml
</span></span><span class="line"><span class="cl">-rw-r--r--    1 node     node          2439 Feb 14 14:19 _config.yml
</span></span><span class="line"><span class="cl">-rw-rw-r--    1 node     node           287 Feb 14 11:32 docker-compose.yml
</span></span><span class="line"><span class="cl">drwxr-xr-x  166 node     node          4096 Feb 14 14:19 node_modules
</span></span><span class="line"><span class="cl">-rw-r--r--    1 node     node           615 Feb 14 14:19 package.json
</span></span><span class="line"><span class="cl">drwxr-xr-x    2 node     node          4096 Feb 14 14:19 scaffolds
</span></span><span class="line"><span class="cl">drwxr-xr-x    3 node     node          4096 Feb 14 14:19 source
</span></span><span class="line"><span class="cl">drwxr-xr-x    2 node     node          4096 Feb 14 14:21 temp
</span></span><span class="line"><span class="cl">drwxr-xr-x    2 node     node          4096 Feb 14 14:19 themes
</span></span><span class="line"><span class="cl">-rw-r--r--    1 node     node         52871 Feb 14 14:19 yarn.lock
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl"><span class="c1">#/app $ </span>
</span></span><span class="line"><span class="cl">ls -l temp
</span></span><span class="line"><span class="cl"><span class="c1">#total 0</span>
</span></span></code></pre></div><p>The temp directory can be removed:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">rm -fr ./temp/
</span></span><span class="line"><span class="cl">ls -l
</span></span><span class="line"><span class="cl"><span class="c1"># check the temp directory has been removed</span>
</span></span><span class="line"><span class="cl">yarn
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">yarn install v1.22.4
</span></span><span class="line"><span class="cl">[1/4] Resolving packages...
</span></span><span class="line"><span class="cl">[2/4] Fetching packages...
</span></span><span class="line"><span class="cl">info fsevents@2.3.2: The platform &#34;linux&#34; is incompatible with this module.
</span></span><span class="line"><span class="cl">info &#34;fsevents@2.3.2&#34; is an optional dependency and failed compatibility check. ...
</span></span><span class="line"><span class="cl">[3/4] Linking dependencies...
</span></span><span class="line"><span class="cl">[4/4] Building fresh packages...
</span></span><span class="line"><span class="cl">Done in 0.54s.
</span></span></code></pre></div><h3 id="add-hexo-as-a-project-dependency" class="relative group">Add Hexo as a project dependency <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#add-hexo-as-a-project-dependency" aria-label="Anchor">#</a></span></h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">yarn add hexo
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">yarn add v1.22.4
</span></span><span class="line"><span class="cl">[1/4] Resolving packages...
</span></span><span class="line"><span class="cl">[2/4] Fetching packages...
</span></span><span class="line"><span class="cl">info fsevents@2.3.2: The platform &#34;linux&#34; is incompatible with this module.
</span></span><span class="line"><span class="cl">info &#34;fsevents@2.3.2&#34; is an optional dependency and failed compatibility check. ...
</span></span><span class="line"><span class="cl">[3/4] Linking dependencies...
</span></span><span class="line"><span class="cl">[4/4] Building fresh packages...
</span></span><span class="line"><span class="cl">success Saved lockfile.
</span></span><span class="line"><span class="cl">success Saved 1 new dependency.
</span></span><span class="line"><span class="cl">info Direct dependencies
</span></span><span class="line"><span class="cl">‚îî‚îÄ hexo@5.3.0
</span></span><span class="line"><span class="cl">info All dependencies
</span></span><span class="line"><span class="cl">‚îî‚îÄ hexo@5.3.0
</span></span><span class="line"><span class="cl">Done in 0.77s.
</span></span></code></pre></div><p>Exit out of all the terminals.</p>
<h3 id="reset-the-permissions" class="relative group">Reset the permissions <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#reset-the-permissions" aria-label="Anchor">#</a></span></h3>
<p>Open a new terminal:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">docker ps
</span></span><span class="line"><span class="cl"><span class="c1"># There should be no running containers</span>
</span></span><span class="line"><span class="cl">make chown
</span></span><span class="line"><span class="cl"><span class="c1"># docker-compose exec -u 0:0 server chown -R 1000:1000 ./</span>
</span></span><span class="line"><span class="cl">ls -l
</span></span></code></pre></div><p>We installed hexo under our account, this was probably is an unnecessary step. All the files and folders are under my
username and group:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">total 104
</span></span><span class="line"><span class="cl">-rw-r--r--   1 michael michael     0 Feb 14 14:19 _config.landscape.yml
</span></span><span class="line"><span class="cl">-rw-r--r--   1 michael michael  2439 Feb 14 14:19 _config.yml
</span></span><span class="line"><span class="cl">-rw-r--r--   1 michael michael 19700 Feb 14 14:27 db.json
</span></span><span class="line"><span class="cl">-rw-rw-r--   1 michael michael   287 Feb 14 14:26 docker-compose.yml
</span></span><span class="line"><span class="cl">-rw-rw-r--   1 michael michael  1316 Feb 14 13:25 Makefile
</span></span><span class="line"><span class="cl">drwxr-xr-x 171 michael michael  4096 Feb 14 14:23 node_modules
</span></span><span class="line"><span class="cl">-rw-r--r--   1 michael michael   619 Feb 14 14:27 package.json
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 michael michael  4096 Feb 14 14:19 scaffolds
</span></span><span class="line"><span class="cl">drwxr-xr-x   3 michael michael  4096 Feb 14 14:19 source
</span></span><span class="line"><span class="cl">drwxr-xr-x   2 michael michael  4096 Feb 14 14:19 themes
</span></span><span class="line"><span class="cl">-rw-r--r--   1 michael michael 52871 Feb 14 14:23 yarn.lock
</span></span></code></pre></div><p>We can start the website</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">make up
</span></span></code></pre></div><p>Open the browser to <a href="localhost:4000">localhost:4000</a>. The Hexo default page will open showing a Hello World blog post.</p>
<p>



  
  
    
  
  
    <figure>
      <img
        class="my-0 rounded-md"
        srcset="
          /2021/02/12/Troubleshooting-Docker/images/hexo-demo_hu267a0bf1ac4c08ebc72d0037ff43dc70_360549_330x0_resize_box_3.png 330w,
          /2021/02/12/Troubleshooting-Docker/images/hexo-demo_hu267a0bf1ac4c08ebc72d0037ff43dc70_360549_660x0_resize_box_3.png 660w,
          /2021/02/12/Troubleshooting-Docker/images/hexo-demo_hu267a0bf1ac4c08ebc72d0037ff43dc70_360549_1024x0_resize_box_3.png 1024w,
          /2021/02/12/Troubleshooting-Docker/images/hexo-demo_hu267a0bf1ac4c08ebc72d0037ff43dc70_360549_1320x0_resize_box_3.png 2x"
        src="/2021/02/12/Troubleshooting-Docker/images/hexo-demo_hu267a0bf1ac4c08ebc72d0037ff43dc70_360549_660x0_resize_box_3.png"
        alt="Hexo hello word demo"
      />
      <figcaption>Hexo hello word demo</figcaption>
    </figure>
  

</p>
<h2 id="summary" class="relative group">Summary <span class="absolute top-0 w-6 transition-opacity opacity-0 ltr:-left-6 rtl:-right-6 not-prose group-hover:opacity-100"><a class="group-hover:text-primary-300 dark:group-hover:text-neutral-700" style="text-decoration-line: none !important;" href="#summary" aria-label="Anchor">#</a></span></h2>
<p>Docker is a powerful development environment. By using the right image, extending them as required, they give us the
required tools to do our job.</p>
<p>File permissions are the bain of Docker on Linux. Once we know how to run the containers, under the correct accounts and
how to change the file and folder permissions, this problem is quickly overcome.</p>
<p>Using Dockerfile with <strong>docker-compose.yml</strong> and <strong>Makefile</strong>. The project environment becomes much easy to work with.</p>
<p>Edit: Replaced ${UID}:${UID} with ${shell id -u}:${shell id -g}</p>

      </div>
    </section>
    <footer class="pt-8 max-w-prose print:hidden">
      
  <div class="flex">
    
      
      
        
        <img
          class="w-24 h-24 !mt-0 !mb-0 ltr:mr-4 rtl:ml-4 rounded-full"
          width="96"
          height="96"
          alt="Michael Pritchard (AKA Pen-y-Fan)"
          src="/img/author_hu5893a0bcecd6e8dce34dc674da9c7f56_6794556_192x192_fill_q75_box_smart1.jpg"
        />
      
    
    <div class="place-self-center">
      
        <div class="text-[0.6rem] leading-3 text-neutral-500 dark:text-neutral-400 uppercase">
          Author
        </div>
        <div class="font-semibold leading-6 text-neutral-800 dark:text-neutral-300">
          Michael Pritchard (AKA Pen-y-Fan)
        </div>
      
      
        <div class="text-sm text-neutral-700 dark:text-neutral-400">Posts about my coding experiences, primarily for my learning path with PHP, good clean professional code.</div>
      
      <div class="text-2xl sm:text-lg">
  <div class="flex flex-wrap text-neutral-400 dark:text-neutral-500">
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://github.com/Pen-y-Fan"
          target="_blank"
          aria-label="Github"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.linkedin.com/in/michael-pritchard-340b4520/"
          target="_blank"
          aria-label="Linkedin"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://www.reddit.com/user/Pen-y-Fan"
          target="_blank"
          aria-label="Reddit"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="px-1 hover:text-primary-700 dark:hover:text-primary-400"
          href="https://twitter.com/MikeAPritch"
          target="_blank"
          aria-label="Twitter"
          rel="me noopener noreferrer"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
  </div>

</div>
    </div>
  </div>


      
  
  <section class="flex flex-row flex-wrap justify-center pt-4 text-xl">
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.facebook.com/sharer/sharer.php?u=https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/&amp;quote=Troubleshooting%20Docker"
          title="Share on Facebook"
          aria-label="Share on Facebook"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://twitter.com/intent/tweet/?url=https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/&amp;text=Troubleshooting%20Docker"
          title="Tweet on Twitter"
          aria-label="Tweet on Twitter"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://pinterest.com/pin/create/bookmarklet/?url=https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/&amp;description=Troubleshooting%20Docker"
          title="Pin on Pinterest"
          aria-label="Pin on Pinterest"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M496 256c0 137-111 248-248 248-25.6 0-50.2-3.9-73.4-11.1 10.1-16.5 25.2-43.5 30.8-65 3-11.6 15.4-59 15.4-59 8.1 15.4 31.7 28.5 56.8 28.5 74.8 0 128.7-68.8 128.7-154.3 0-81.9-66.9-143.2-152.9-143.2-107 0-163.9 71.8-163.9 150.1 0 36.4 19.4 81.7 50.3 96.1 4.7 2.2 7.2 1.2 8.3-3.3.8-3.4 5-20.3 6.9-28.1.6-2.5.3-4.7-1.7-7.1-10.1-12.5-18.3-35.3-18.3-56.6 0-54.7 41.4-107.6 112-107.6 60.9 0 103.6 41.5 103.6 100.9 0 67.1-33.9 113.6-78 113.6-24.3 0-42.6-20.1-36.7-44.8 7-29.5 20.5-61.3 20.5-82.6 0-19-10.2-34.9-31.4-34.9-24.9 0-44.9 25.7-44.9 60.2 0 22 7.4 36.8 7.4 36.8s-24.5 103.8-29 123.2c-5 21.4-3 51.6-.9 71.2C65.4 450.9 0 361.1 0 256 0 119 111 8 248 8s248 111 248 248z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://reddit.com/submit/?url=https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/&amp;resubmit=true&amp;title=Troubleshooting%20Docker"
          title="Submit to Reddit"
          aria-label="Submit to Reddit"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M201.5 305.5c-13.8 0-24.9-11.1-24.9-24.6 0-13.8 11.1-24.9 24.9-24.9 13.6 0 24.6 11.1 24.6 24.9 0 13.6-11.1 24.6-24.6 24.6zM504 256c0 137-111 248-248 248S8 393 8 256 119 8 256 8s248 111 248 248zm-132.3-41.2c-9.4 0-17.7 3.9-23.8 10-22.4-15.5-52.6-25.5-86.1-26.6l17.4-78.3 55.4 12.5c0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.3 24.9-24.9s-11.1-24.9-24.9-24.9c-9.7 0-18 5.8-22.1 13.8l-61.2-13.6c-3-.8-6.1 1.4-6.9 4.4l-19.1 86.4c-33.2 1.4-63.1 11.3-85.5 26.8-6.1-6.4-14.7-10.2-24.1-10.2-34.9 0-46.3 46.9-14.4 62.8-1.1 5-1.7 10.2-1.7 15.5 0 52.6 59.2 95.2 132 95.2 73.1 0 132.3-42.6 132.3-95.2 0-5.3-.6-10.8-1.9-15.8 31.3-16 19.8-62.5-14.9-62.5zM302.8 331c-18.2 18.2-76.1 17.9-93.6 0-2.2-2.2-6.1-2.2-8.3 0-2.5 2.5-2.5 6.4 0 8.6 22.8 22.8 87.3 22.8 110.2 0 2.5-2.2 2.5-6.1 0-8.6-2.2-2.2-6.1-2.2-8.3 0zm7.7-75c-13.6 0-24.6 11.1-24.6 24.9 0 13.6 11.1 24.6 24.6 24.6 13.8 0 24.9-11.1 24.9-24.6 0-13.8-11-24.9-24.9-24.9z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/&amp;title=Troubleshooting%20Docker"
          title="Share on LinkedIn"
          aria-label="Share on LinkedIn"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>

  </span>

</a
        >
      
    
      
        <a
          class="bg-neutral-300 text-neutral-700 dark:bg-neutral-700 dark:text-neutral-300 dark:hover:bg-primary-400 dark:hover:text-neutral-800 m-1 hover:bg-primary-500 hover:text-neutral rounded min-w-[2.4rem] inline-block text-center p-1"
          href="mailto:?body=https://pen-y-fan.github.io/2021/02/12/Troubleshooting-Docker/&amp;subject=Troubleshooting%20Docker"
          title="Send via email"
          aria-label="Send via email"
          >

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M207.8 20.73c-93.45 18.32-168.7 93.66-187 187.1c-27.64 140.9 68.65 266.2 199.1 285.1c19.01 2.888 36.17-12.26 36.17-31.49l.0001-.6631c0-15.74-11.44-28.88-26.84-31.24c-84.35-12.98-149.2-86.13-149.2-174.2c0-102.9 88.61-185.5 193.4-175.4c91.54 8.869 158.6 91.25 158.6 183.2l0 16.16c0 22.09-17.94 40.05-40 40.05s-40.01-17.96-40.01-40.05v-120.1c0-8.847-7.161-16.02-16.01-16.02l-31.98 .0036c-7.299 0-13.2 4.992-15.12 11.68c-24.85-12.15-54.24-16.38-86.06-5.106c-38.75 13.73-68.12 48.91-73.72 89.64c-9.483 69.01 43.81 128 110.9 128c26.44 0 50.43-9.544 69.59-24.88c24 31.3 65.23 48.69 109.4 37.49C465.2 369.3 496 324.1 495.1 277.2V256.3C495.1 107.1 361.2-9.332 207.8 20.73zM239.1 304.3c-26.47 0-48-21.56-48-48.05s21.53-48.05 48-48.05s48 21.56 48 48.05S266.5 304.3 239.1 304.3z"/></svg>

  </span>

</a
        >
      
    
  </section>


      
  
    
    
    
    <div class="pt-8">
      <hr class="border-dotted border-neutral-300 dark:border-neutral-600" />
      <div class="flex justify-between pt-3">
        <span>
          
            <a class="flex group" href="/2020/10/10/Set-up-PhpStorm-to-use-PHP-with-PHPUnit-and-xDebug-in-Docker/">
              <span
                class="mr-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
              <span
                class="ml-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Set up PhpStorm to use PHP with PHPUnit and xDebug in Docker</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2020-10-10 17:01:32 &#43;0000 UTC">10 October 2020</time>
                  
                </span>
              </span>
            </a>
          
        </span>
        <span>
          
            <a class="flex text-right group" href="/2021/05/23/Standard-setup-for-PHP-projects-2021/">
              <span class="flex flex-col">
                <span
                  class="mt-[0.1rem] leading-6 group-hover:underline group-hover:decoration-primary-500"
                  >Standard setup for PHP projects 2021</span
                >
                <span class="mt-[0.1rem] text-xs text-neutral-500 dark:text-neutral-400">
                  
                    <time datetime="2021-05-23 08:52:27 &#43;0000 UTC">23 May 2021</time>
                  
                </span>
              </span>
              <span
                class="ml-3 ltr:inline rtl:hidden text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&rarr;</span
              >
              <span
                class="mr-3 ltr:hidden rtl:inline text-neutral-700 dark:text-neutral group-hover:text-primary-600 dark:group-hover:text-primary-400"
                >&larr;</span
              >
            </a>
          
        </span>
      </div>
    </div>
  


      
    </footer>
  </article>

        
          <div
            class="absolute top-[100vh] ltr:right-0 rtl:left-0 w-12 pointer-events-none bottom-0"
          >
            <a
              href="#the-top"
              class="w-12 h-12 sticky pointer-events-auto top-[calc(100vh-5.5rem)] bg-neutral/50 dark:bg-neutral-800/50 backdrop-blur rounded-full text-xl flex items-center justify-center text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400"
              aria-label="Scroll to top"
              title="Scroll to top"
            >
              &uarr;
            </a>
          </div>
        
      </main><footer class="py-10 print:hidden">
  
  
  <div class="flex items-center justify-between">
    <div>
      
      
        <p class="text-sm text-neutral-500 dark:text-neutral-400">
            ¬©Ô∏è Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)
        </p>
      
      
      
        <p class="text-xs text-neutral-500 dark:text-neutral-400">
          
          
          Powered by <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500"
            href="https://gohugo.io/" target="_blank" rel="noopener noreferrer">Hugo</a> &amp; <a class="hover:underline hover:decoration-primary-400 hover:text-primary-500" href="https://git.io/hugo-congo" target="_blank" rel="noopener noreferrer">Congo</a>
        </p>
      
    </div>
    
    
      <div
        class="text-sm cursor-pointer text-neutral-700 dark:text-neutral hover:text-primary-600 dark:hover:text-primary-400 ltr:mr-14 rtl:ml-14"
      >
        <button
          id="appearance-switcher"
          class="w-12 h-12 "
          type="button"
          title="Switch to dark appearance"
        >
          <span class="inline dark:hidden">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M32 256c0-123.8 100.3-224 223.8-224c11.36 0 29.7 1.668 40.9 3.746c9.616 1.777 11.75 14.63 3.279 19.44C245 86.5 211.2 144.6 211.2 207.8c0 109.7 99.71 193 208.3 172.3c9.561-1.805 16.28 9.324 10.11 16.95C387.9 448.6 324.8 480 255.8 480C132.1 480 32 379.6 32 256z"/></svg>

  </span>

</span>
          <span class="hidden dark:inline">

  <span class="relative inline-block align-text-bottom icon">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 159.1c-53.02 0-95.1 42.98-95.1 95.1S202.1 351.1 256 351.1s95.1-42.98 95.1-95.1S309 159.1 256 159.1zM509.3 347L446.1 255.1l63.15-91.01c6.332-9.125 1.104-21.74-9.826-23.72l-109-19.7l-19.7-109c-1.975-10.93-14.59-16.16-23.72-9.824L256 65.89L164.1 2.736c-9.125-6.332-21.74-1.107-23.72 9.824L121.6 121.6L12.56 141.3C1.633 143.2-3.596 155.9 2.736 164.1L65.89 256l-63.15 91.01c-6.332 9.125-1.105 21.74 9.824 23.72l109 19.7l19.7 109c1.975 10.93 14.59 16.16 23.72 9.824L256 446.1l91.01 63.15c9.127 6.334 21.75 1.107 23.72-9.822l19.7-109l109-19.7C510.4 368.8 515.6 356.1 509.3 347zM256 383.1c-70.69 0-127.1-57.31-127.1-127.1c0-70.69 57.31-127.1 127.1-127.1s127.1 57.3 127.1 127.1C383.1 326.7 326.7 383.1 256 383.1z"/></svg>

  </span>

</span>
        </button>
      </div>
    
  </div>
  
  
</footer>

    </div>
  </body>
</html>
