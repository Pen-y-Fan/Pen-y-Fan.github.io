






<!doctype html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="author" content="Pen y Fan">
  
  
  <meta name="keywords" content="PHP, Learning, resource, HTML, CSS, Git, Github">
  
  
  
    <meta name="description" content="Photo by">
  
  <title>Troubleshooting Docker [ Pen y Fan ]</title>
  
  
    <link rel="shortcut icon" href="/favicon.ico">
  
  
  
<link rel="stylesheet" href="/css/random.css">
<link rel="stylesheet" href="/css/vegas.min.css">
<link rel="stylesheet" href="/css/highlight-railscasts.css">
<link rel="stylesheet" href="/css/jquery.fancybox.css">
<link rel="stylesheet" href="/css/iconfont/iconfont.css">
<link rel="stylesheet" href="/css/jquery.fancybox-thumbs.css">
<link rel="stylesheet" href="/css/plyr.css">

  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
<div class="side-navigate hide-area">
  
    <div class="item prev">
      <a href="/2021/05/23/Standard-setup-for-PHP-projects-2021/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        Standard setup for PHP projects 2021
      </div>
    </div>
  
  
    <div class="item next">
      <a href="/2020/10/10/Set-up-PhpStorm-to-use-PHP-with-PHPUnit-and-xDebug-in-Docker/">
        <div class="item-icon"></div>
      </a>
      <div class="item-title">
        Set up PhpStorm to use PHP with PHPUnit and xDebug in Docker
      </div>
    </div>
  
</div>
<div id="outer-container" class="hide-area">
<div id="container">
  <div id="menu-outer" class="slide-down">
    <div id="menu-inner">
      <div id="brand">
        
        <a onClick="openUserCard()">
          <img id="avatar" src="https://avatars3.githubusercontent.com/u/40126936?s=400&amp;u=957f8c1cbfeeb61a853b9e28eb2968352a77cc79&amp;v=4" alt="Pen y Fan"/>
          <div id="homelink">Pen y Fan</div>
        </a>
      </div>
      <div id="menu-list">
        <ul>
        
        
          
            <li>
          
            <a href="/index.html">Home</a>
            
          </li>
        
          
            <li>
          
            <a href="/archives">Posts</a>
            
          </li>
        
          
            <li>
          
            <a href="/tags">Tags</a>
            
          </li>
        
          
            <li>
          
            <a href="/categories">Categories</a>
            
          </li>
        
          
            <li>
          
            <a href="/about">About</a>
            
          </li>
        
          
            <li>
          
            <a href="https://github.com/pen-y-fan" target="_blank" rel="noopener">Github</a>
            
          </li>
        
        </ul>
      </div>
      <div id="show-menu">
        <button>Menu</button>
      </div>
    </div>
  </div>

  <div id="content-outer">
    <div id="content-inner">
      
      
  

  <article id="post">
    <h1>Troubleshooting Docker</h1>
    <p class="page-title-sub">
      <span id = "post-title-date">Created at 2021-02-12</span>
      
        <span id = "post-title-updated">Updated at 2021-02-24</span>
      
      
      <span id = "post-title-categories">Category
      
      
        
        
        <a href="/categories/Docker/">Docker</a>
      
      </span>
      
      
      <span id = "post-title-tags">
      Tag
      
      
        
        
        <a href="/tags/Docker/">Docker</a>
      
        
          /
        
        
        <a href="/tags/Tutorial/">Tutorial</a>
      
        
          /
        
        
        <a href="/tags/Linux/">Linux</a>
      
      </span>
      
    </p>
    
    <p><img src="/2021/02/12/Troubleshooting-Docker/ines-mills-TGs0tHMk4eg-unsplash.jpg" alt="Containers arch" title="Containers arch"><br>Photo by <a href="https://unsplash.com/@inesmills?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank" rel="noopener"">ines mills</a> on <a href="https://unsplash.com/s/photos/shipping-container?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" target="_blank" rel="noopener">Unsplash</a>.</p>
<p>I have been using Docker since I installed <a href="./Pop-OS-new-install.md">Pop!_OS On my laptop Oct 2020</a>. I deliberately have not installed PHP, MySQL or Apache on my laptop, which has forced me to learn to use Docker!</p>
<p>The first tutorial I followed was the Docker docs <a href="https://docs.docker.com/get-started/" target="_blank" rel="noopener">get started</a> after I installed Docker. I found this to be a useful introduction, even though I wanted a PHP environment, the guide still explained the basics of Docker. I will not cover the basics here, as these are already well covered in the getting started documentation, there are many youtube channels, some I have watched are:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=YFl2mCHdv24" target="_blank" rel="noopener">Learn Docker in 12 Minutes üê≥</a> by Jake Wright </li>
<li><a href="https://www.youtube.com/watch?v=fqMOX6JJhGo" target="_blank" rel="noopener">Docker Tutorial for Beginners - A Full DevOps Course on How to Run Applications in Containers</a> by freeCodeCamp.org</li>
<li><a href="https://www.youtube.com/watch?v=Kyx2PsuwomE" target="_blank" rel="noopener">Exploring Docker [1] - Getting Started</a> and </li>
<li><a href="https://www.youtube.com/watch?v=hP77Rua1E0c" target="_blank" rel="noopener">Exploring Docker [2] - Docker Compose With Node &amp; MongoDB</a> by Traversy Media.</li>
</ul>
<p>Brad Traversy has also published an excellent gist:</p>
<ul>
<li><a href="https://gist.github.com/bradtraversy/89fad226dc058a41b596d586022a9bd3" target="_blank" rel="noopener">Docker Commands, Help &amp; Tips</a> with all the basic commands!</li>
</ul>
<h2 id="So-what-is-the-blog-about"><a href="#So-what-is-the-blog-about" class="headerlink" title="So what is the blog about?"></a>So what is the blog about?</h2><p>What I want to cover are the parts beyond the basics. </p>
<ul>
<li>file permissions are one of my biggest problems</li>
<li>creating a development environment, with the tooling I want at my fingertips.</li>
</ul>
<h2 id="File-permissions"><a href="#File-permissions" class="headerlink" title="File permissions"></a>File permissions</h2><p>One of the first hurdles I came across was file permissions. This seems to be particularly on Linux. When the container is launched, the default user is root. If any files are changed, the file system on the OS will be assigned to root!</p>
<p>For example, if we pull down a repository and want to spin up a docker container for composer <code>docker run composer install</code>, however, the vendor folder will be created as root, along with all the files and subfolders.</p>
<p>The initial workaround is to run <code>chown</code> from the host machine, e.g.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo chown -R michael:michael ./vendor</span><br><span class="line"><span class="comment"># or</span></span><br><span class="line">sudo chown -R $(id -u):$(id -g) ./vendor</span><br></pre></td></tr></table></figure>

<p><code>$(id -u):$(id -g)</code> is a way of getting the username and group of the signed-in user. e.g.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line"><span class="meta">#</span><span class="bash"> michael</span></span><br><span class="line">id -u</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1000</span></span><br><span class="line">id -g</span><br><span class="line"><span class="meta">#</span><span class="bash"> 1000</span></span><br><span class="line">id $(whoami)</span><br><span class="line"><span class="meta">#</span><span class="bash"> uid=1000(michael) gid=1000(michael) groups=1000(michael),...</span></span><br></pre></td></tr></table></figure>

<p>Examples of options are uid:gid, this is normally 1000:1000, or user:group, in my case michael:michael. Further reading <a href="https://kb.iu.edu/d/adwf" target="_blank" rel="noopener">Find a user‚Äôs UID or GID in Unix</a>. Further details on <a href="https://jtreminio.com/blog/running-docker-containers-as-current-host-user/" target="_blank" rel="noopener">Running Docker Containers as Current Host User</a>.</p>
<h2 id="Composer-Docker-Image"><a href="#Composer-Docker-Image" class="headerlink" title="Composer Docker Image"></a>Composer Docker Image</h2><p>Composer is the dependency manager for PHP.</p>
<ul>
<li><a href="https://hub.docker.com/_/composer" target="_blank" rel="noopener">Docker hub composer images</a></li>
</ul>
<h3 id="Basic-usage"><a href="#Basic-usage" class="headerlink" title="Basic usage"></a>Basic usage</h3><p>The documentation has the following basic usage:</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --interactive --tty \</span><br><span class="line">  --volume $PWD:/app \</span><br><span class="line">  composer install</span><br></pre></td></tr></table></figure>

<p>The same command can be converted to the shorter syntax. By making it into one line, allowing easier copying and pasting.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -it -v $PWD:/app composer install</span><br></pre></td></tr></table></figure>

<p>An explanation for the command line:</p>
<ul>
<li><code>docker run</code> runs a new instance of a docker image creating a container</li>
<li><a href="https://docs.docker.com/engine/reference/run/#clean-up---rm" target="_blank" rel="noopener">Clean up (‚Äìrm)</a> automatically clean up the container<br>and remove the file system when the container exits, <strong>Note</strong> the <strong>double</strong> minus in <code>--rm</code>!</li>
<li><a href="https://docs.docker.com/engine/reference/run/#foreground" target="_blank" rel="noopener">‚Äìinteractive ‚Äìtty / -i -t / -it</a> For interactive<br>processes (like a shell), you must use -i -t together to allocate a tty for the container process. -i -t is<br>often written -it</li>
<li><a href="https://docs.docker.com/engine/reference/run/#volume-shared-filesystems" target="_blank" rel="noopener">‚Äìvolume / -v $PWD:/app</a> Bind the host file<br>system to the destination, $PWD is the current working directory, /app is the destination directory. On Windows it<br>should be the full path name e.g. c:/laragon/www/php-project</li>
<li><code>composer</code> the image to be run</li>
<li><code>install</code> is the command to run inside the docker container. This can be any composer command!</li>
</ul>
<p>For more details please see the <a href="https://docs.docker.com/engine/reference/run/" target="_blank" rel="noopener">Docker run reference</a>.</p>
<h3 id="Fixing-filesystem-permissions"><a href="#Fixing-filesystem-permissions" class="headerlink" title="Fixing filesystem permissions"></a>Fixing filesystem permissions</h3><p>By default, Composer runs as root inside the container. This can lead to permission issues on your host filesystem. You can work around this by running the container under the signed-in user:</p>
<figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --interactive --tty \</span><br><span class="line">  --volume $PWD:/app \</span><br><span class="line">  --user $(id -u):$(id -g) \</span><br><span class="line">  composer install</span><br></pre></td></tr></table></figure>

<p>Again the short, but slightly less readably syntax, can be used to make one line version, with some example commands:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -it -v $PWD:/app -u $(id -u):$(id -g) composer install</span><br><span class="line">docker run --rm -it -v $PWD:/app -u $(id -u):$(id -g) composer update</span><br><span class="line">docker run --rm -v $PWD:/app -u $(id -u):$(id -g) composer test</span><br><span class="line">docker run --rm -v $PWD:/app -u $(id -u):$(id -g) composer check-cs</span><br><span class="line">docker run --rm -v $PWD:/app -u $(id -u):$(id -g) composer phpstan</span><br></pre></td></tr></table></figure>

<p>You may notice, install and update have an interactive terminal -it. The test, check-cs and phpstan do not. Sometimes Composer asks questions, which need user input, to run tests and lint code this is not required.</p>
<p>The composer config file <strong>composer.json</strong> would contain the scripts for <strong>test</strong>, <strong>check-cs</strong> and <strong>phpstan</strong> e.g.:</p>
<p><strong>composer.json</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"scripts"</span>: &#123;</span><br><span class="line">    <span class="attr">"test"</span>: <span class="string">"phpunit"</span>,</span><br><span class="line">    <span class="attr">"check-cs"</span>: <span class="string">"ecs check --ansi"</span>,</span><br><span class="line">    <span class="attr">"phpstan"</span>: <span class="string">"phpstan analyse --ansi"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The command is similar, as explained above, with -u or ‚Äìuser added:</p>
<ul>
<li><a href="https://docs.docker.com/engine/reference/run/#user" target="_blank" rel="noopener">‚Äìuser or -u</a> Sets the username or UID used and optionally the group name or GID for the specified command</li>
<li><code>$(id -u):$(id -g)</code> is a way of getting the username and group of the signed-in user. e.g.</li>
</ul>
<p>This is required on Linux. The OS and docker container share the same file system. The docker container will normally run under user 0, root user, meaning any files written to the shared volume by the container, will be created by the root user.</p>
<h3 id="Install-composer-programmatically"><a href="#Install-composer-programmatically" class="headerlink" title="Install composer programmatically"></a>Install composer programmatically</h3><p>Sometimes Composer will not run the <strong>install</strong> command:</p>
<ul>
<li>Composer doesn‚Äôt have the correct dependencies </li>
<li>Composer isn‚Äôt the correct version of PHP.</li>
</ul>
<p>For example, if I try to install Silverstripe, which needs the PHP <strong>intl</strong> extension:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:Pen-y-Fan/silverstripe-lessons.git</span><br><span class="line"><span class="built_in">cd</span> silverstripe-lessons</span><br><span class="line">docker run --rm -it -v <span class="variable">$PWD</span>:/app -u $(id -u):$(id -g) composer install</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">Your requirements could not be resolved to an installable set of packages.</span><br><span class="line"></span><br><span class="line">  Problem 1</span><br><span class="line">    - Installation request for silverstripe&#x2F;framework 4.5.2 -&gt; satisfiable by </span><br><span class="line">      silverstripe&#x2F;framework[4.5.2].</span><br><span class="line">    - silverstripe&#x2F;framework 4.5.2 requires ext-intl * -&gt; the requested PHP </span><br><span class="line">      extension intl is missing from your system.</span><br><span class="line">  Problem 2</span><br><span class="line">    - silverstripe&#x2F;framework 4.5.2 requires ext-intl * -&gt; the requested PHP </span><br><span class="line">      extension intl is missing from your system.</span><br><span class="line">    - silverstripe&#x2F;versioned-admin 1.3.1 requires silverstripe&#x2F;framework ^4.5 -&gt; </span><br><span class="line">      satisfiable by silverstripe&#x2F;framework[4.5.2].</span><br><span class="line">    - Installation request for silverstripe&#x2F;versioned-admin 1.3.1 -&gt; satisfiable </span><br><span class="line">      by silverstripe&#x2F;versioned-admin[1.3.1].</span><br><span class="line"></span><br><span class="line">  To enable extensions, verify that they are enabled in your .ini files:</span><br><span class="line">    - &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;php-cli.ini</span><br><span class="line">    - &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;docker-php-ext-sodium.ini</span><br><span class="line">    - &#x2F;usr&#x2F;local&#x2F;etc&#x2F;php&#x2F;conf.d&#x2F;docker-php-ext-zip.ini</span><br><span class="line">  You can also run &#96;php --ini&#96; inside terminal to see which files are used by PHP</span><br><span class="line">  in CLI mode.</span><br></pre></td></tr></table></figure>

<p>Likewise as more project become php8 only, for example:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:Pen-y-Fan/hello-world-php8.git</span><br><span class="line"><span class="built_in">cd</span> hello-world-php8</span><br><span class="line">docker run --rm -it -v <span class="variable">$PWD</span>:/app -u $(id -u):$(id -g) composer install</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: Uncaught ParseError: syntax error, unexpected &#39;:&#39;, expecting &#39;)&#39; in </span><br><span class="line">&#x2F;app&#x2F;tests&#x2F;HelloWorldTest.php:14</span><br><span class="line"></span><br><span class="line">Or</span><br><span class="line"></span><br><span class="line">Fatal error: Composer detected issues in your platform: Your Composer dependencies </span><br><span class="line">require a PHP version &quot;&gt;&#x3D; 8.0.0&quot;. You are running 7.4.14. in </span><br><span class="line">&#x2F;app&#x2F;vendor&#x2F;composer&#x2F;platform_check.php on line 24</span><br></pre></td></tr></table></figure>

<h3 id="Possible-workarounds"><a href="#Possible-workarounds" class="headerlink" title="Possible workarounds"></a>Possible workarounds</h3><p>One workaround is to spin-up the version of PHP required, with the extensions and programmatically add Composer.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/sh</span></span><br><span class="line">DOCKER_HOME=~/tmp</span><br><span class="line">EXPECTED_CHECKSUM="$(wget -q -O - https://composer.github.io/installer.sig)"</span><br><span class="line">php -r "copy('https://getcomposer.org/installer', 'composer-setup.php');"</span><br><span class="line">ACTUAL_CHECKSUM="$(php -r "echo hash_file('sha384', 'composer-setup.php');")"</span><br><span class="line"></span><br><span class="line">if [ "$EXPECTED_CHECKSUM" != "$ACTUAL_CHECKSUM" ]</span><br><span class="line">then</span><br><span class="line">    &gt;&amp;2 echo 'ERROR: Invalid installer checksum'</span><br><span class="line">    rm composer-setup.php</span><br><span class="line">    exit 1</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">php composer-setup.php --quiet --install-dir=/usr/local/bin/ --filename=composer</span><br><span class="line">RESULT=$?</span><br><span class="line">rm composer-setup.php</span><br><span class="line"><span class="meta">#</span><span class="bash"> smoke <span class="built_in">test</span></span></span><br><span class="line">composer --version</span><br><span class="line">exit $RESULT</span><br></pre></td></tr></table></figure>

<ul>
<li>Source: <a href="https://getcomposer.org/doc/faqs/how-to-install-composer-programmatically.md" target="_blank" rel="noopener">How do I install Composer programmatically?</a></li>
</ul>
<h3 id="Troubleshooting-Composer"><a href="#Troubleshooting-Composer" class="headerlink" title="Troubleshooting Composer"></a>Troubleshooting Composer</h3><p>The <a href="https://hub.docker.com/_/composer/" target="_blank" rel="noopener">Composer Docker hub documentation</a> also has the following suggestions:</p>
<ul>
<li><strong>optimal</strong> create your image and install Composer inside it.</li>
</ul>
<p><strong>Note:</strong> Docker 17.05 introduced multi-stage builds, simplifying this enormously:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">COPY</span><span class="bash"> --from=composer /usr/bin/composer /usr/bin/composer</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong>alternatively</strong> specify the target platform / extension(s) in your composer.json:</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"config"</span>: &#123;</span><br><span class="line">    <span class="attr">"platform"</span>: &#123;</span><br><span class="line">      <span class="attr">"php"</span>: <span class="string">"MAJOR.MINOR.PATCH"</span>,</span><br><span class="line">      <span class="attr">"ext-something"</span>: <span class="string">"MAJOR.MINOR.PATCH"</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>discouraged</strong> pass the ‚Äìignore-platform-reqs and / or ‚Äìno-scripts flags to install or update:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm --interactive --tty \</span><br><span class="line">--volume <span class="variable">$PWD</span>:/app \</span><br><span class="line">composer install --ignore-platform-reqs --no-scripts</span><br></pre></td></tr></table></figure>

<h2 id="Example-Dockerfile"><a href="#Example-Dockerfile" class="headerlink" title="Example Dockerfile"></a>Example Dockerfile</h2><p>The docker image for the Silverstripe CMS has extensions like <strong>tidy</strong> and <strong>intl</strong> enabled. The Composer image doesn‚Äôt! This Dockerfile will copy Composer into the Silverstripe image.</p>
<p><strong>Dockerfile</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">FROM brettt89/silverstripe-web:7.4-apache</span><br><span class="line">COPY --from=composer /usr/bin/composer /usr/bin/composer</span><br><span class="line">RUN composer self-update --2</span><br></pre></td></tr></table></figure>

<p>The <strong>docker-compose.yml</strong> file would something like:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">"3.3"</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">silverstripe:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="comment"># image: brettt89/silverstripe-web:7.4-apache</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"8081:80"</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/var/www/html</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">database</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">DOCUMENT_ROOT=/var/www/html/public</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_TRUSTED_PROXY_IPS=*</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_ENVIRONMENT_TYPE=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_DATABASE_SERVER=database</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_DATABASE_NAME=SS_mysite</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_DATABASE_USERNAME=root</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_DATABASE_PASSWORD=</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_DEFAULT_ADMIN_USERNAME=admin</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">SS_DEFAULT_ADMIN_PASSWORD=password</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">database:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"33060:3306"</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MYSQL_ALLOW_EMPTY_PASSWORD=yes</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">db-data:/var/lib/mysql</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br></pre></td></tr></table></figure>

<p>Once the <code>docker-compose up -d</code> is run, to spin up the containers. The <strong>silverstripe</strong> container will have Composer installed. This can be accessed from the terminal within the running container:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose <span class="built_in">exec</span> -it -u $(id -u):$(id -g) silverstripe composer install</span><br></pre></td></tr></table></figure>

<h2 id="How-to-create-a-project-from-within-a-Docker-container"><a href="#How-to-create-a-project-from-within-a-Docker-container" class="headerlink" title="How to create a project from within a Docker container"></a>How to create a project from within a Docker container</h2><p>Sometimes new projects need to be created from the command line, for example using <code>composer create-project</code>. This is before the project folder has been created, therefore <strong>docker-compose.yml</strong> can not be created, in the project folder. This is a chicken and egg situation. The project can‚Äôt be started without the tooling, and the tooling can‚Äôt be spun up without a project folder.</p>
<p>The solution, with <code>composer create-project</code> at least it to create the project folder, spin up the environment, then create the project in the same folder.</p>
<p>Navigate to your normal project root e.g.:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cd ~/PhpstormProjects/</span><br><span class="line">mkdir ./silverstripe-demo</span><br><span class="line">cd ./silverstripe-demo</span><br><span class="line">touch ./Dockerfile</span><br><span class="line">touch ./docker-compose.yml</span><br><span class="line">touch ./Makefile</span><br><span class="line">phpstorm .</span><br></pre></td></tr></table></figure>

<p>This will:</p>
<ul>
<li>create the required directory</li>
<li>add empty Dockerfile, docker-compose.yml and Makefile</li>
<li>start PhpStorm</li>
</ul>
<p>Now PhpStorm is launched its starting to feel like we are working on a project. The Dockerfile from above can be pasted in the Dockerfile, as can the docker-compose.yml from above in its corresponding file. That leaves us the Makefile.</p>
<p>Makefiles are a simple way to run shell scripts, like batch files in Windows, except there can be several scripts which can be called by their key. For example:</p>
<p><strong>Makefile</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Set UID to your user ID. To check your user ID run `<span class="built_in">echo</span> $(id -u)`</span></span><br><span class="line">UID = 1000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Usage:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make up - starts the docker-compose <span class="keyword">in</span> the same directory <span class="keyword">in</span> demon (background)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make down - stops the docker-compose</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell - opens a bash terminal inside the Silverstripe container as a standard user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell-root -  opens a bash <span class="keyword">in</span> Silverstripe container as the root user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell-web -  opens a bash <span class="keyword">in</span> Silverstripe container as www-data user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make up<span class="_">-f</span> - start the docker-compose <span class="keyword">in</span> the foreground (useful <span class="keyword">for</span> error messages)</span></span><br><span class="line"></span><br><span class="line">up:</span><br><span class="line">	docker-compose up --build --remove-orphans -d</span><br><span class="line">up-f:</span><br><span class="line">	docker-compose up --build --remove-orphans</span><br><span class="line">down:</span><br><span class="line">	docker-compose down --remove-orphans</span><br><span class="line">shell:</span><br><span class="line">	docker-compose exec -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; silverstripe bash</span><br><span class="line">shell-run:</span><br><span class="line">	docker-compose run -rm -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; silverstripe bash</span><br><span class="line">shell-root:</span><br><span class="line">	docker-compose exec -u 0:0 silverstripe bash</span><br><span class="line">shell-web:</span><br><span class="line">	docker-compose exec -u 33:33 silverstripe bash</span><br><span class="line">.PHONY : tests</span><br><span class="line">tests:</span><br><span class="line">	docker-compose exec silverstripe vendor/bin/phpunit</span><br><span class="line">	docker-compose exec silverstripe chown -R $&#123;shell id -u&#125;:$&#123;shell id -g&#125; ./</span><br><span class="line">	docker-compose exec silverstripe chown -R 33:33 ./public/</span><br><span class="line">lint:</span><br><span class="line">	docker-compose exec -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; silverstripe vendor/bin/phpcs app/src app/tests</span><br><span class="line">lint-clean:</span><br><span class="line">	docker-compose exec -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; silverstripe vendor/bin/phpcbf app/src app/tests</span><br><span class="line">flush:</span><br><span class="line">	docker-compose exec silverstripe vendor/bin/phpunit app/tests '' flush=1</span><br><span class="line">	docker-compose exec silverstripe chown -R $&#123;shell id -u&#125;:$&#123;shell id -g&#125; ./</span><br><span class="line">	docker-compose exec silverstripe chown -R 33:33 ./public/</span><br><span class="line"></span><br><span class="line">chown:</span><br><span class="line">	docker-compose exec silverstripe chown -R $&#123;shell id -u&#125;:$&#123;shell id -g&#125; ./</span><br><span class="line">	docker-compose exec silverstripe chown -R 33:33 ./public/</span><br></pre></td></tr></table></figure>

<p>You can see the Makefile contains the standard docker-compose commands, as you would normally run from the command line. These work closely with the <strong>docker-compose.yml</strong> file to run the required commands. The make commands can be run using <code>make</code> and the required key.</p>
<p>Normally, the container is up, therefore we can <strong>exec</strong> into the running container. Before we start the project we need to <strong>run</strong> the container using bash, which will allow access to Composer:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make shell-run</span><br></pre></td></tr></table></figure>

<p>From within the docker container, we now have Composer:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># I have no name!@b8a8ee52a81b:/var/www/html$ </span></span><br><span class="line">composer --version</span><br><span class="line"><span class="comment"># Composer version 2.0.9 2021-01-27 16:09:27</span></span><br></pre></td></tr></table></figure>

<p>It would be easier to create the project in this folder, unfortunately, Composer will not allow it, as the folder is not empty:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">composer create-project silverstripe/installer .</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; ...</span><br><span class="line">Creating a &quot;silverstripe&#x2F;installer&quot; project at &quot;.&#x2F;&quot;</span><br><span class="line"></span><br><span class="line">                                                     </span><br><span class="line">  [InvalidArgumentException]                         </span><br><span class="line">  Project directory &quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;.&quot; is not empty.</span><br></pre></td></tr></table></figure>

<p>We, therefore, need to create the project, in a temp child folder. Then move it to this folder once run:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">composer create-project silverstripe/installer temp</span><br><span class="line"><span class="comment"># once installed move the temp folder:</span></span><br><span class="line">mv ./temp/* ./</span><br><span class="line">ls -l</span><br></pre></td></tr></table></figure>

<p>You should see output like this:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">-rw-rw-r--  1     1000     1000    128 Feb 14 09:42 Dockerfile</span><br><span class="line">-rw-rw-r--  1     1000     1000   1538 Feb 14 09:34 Makefile</span><br><span class="line">-rw-r--r--  1     1000     1000   3019 Feb 14 12:23 README.md</span><br><span class="line">drwxr-xr-x  4     1000     1000   4096 Feb 14 09:57 app</span><br><span class="line">-rw-r--r--  1     1000     1000   1055 Feb 14 09:57 composer.json</span><br><span class="line">-rw-r--r--  1     1000     1000 163329 Feb 14 09:57 composer.lock</span><br><span class="line">-rw-rw-r--  1     1000     1000    730 Feb 14 09:40 docker-compose.yml</span><br><span class="line">-rw-r--r--  1     1000     1000    876 Feb 14 09:56 phpcs.xml.dist</span><br><span class="line">drwxr-xr-x  4     1000     1000   4096 Feb 14 09:57 public</span><br><span class="line">drwxr-xr-x  2     1000     1000   4096 Feb 14 10:09 temp</span><br><span class="line">drwxr-xr-x  3     1000     1000   4096 Feb 14 09:57 themes</span><br><span class="line">drwxr-xr-x 27     1000     1000   4096 Feb 14 09:57 vendor</span><br><span class="line">-rw-r--r--  1     1000     1000   1002 Feb 14 09:56 web.config</span><br></pre></td></tr></table></figure>

<p>If so, it is safe to delete the temp directory and exit the container</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rm -dfr ./temp/</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p>Hopefully, the project can be started:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make up</span><br></pre></td></tr></table></figure>

<p>Once up the Silverstripe app will run, in <strong>detached mode</strong>, it can be accessed on <a href="localhost:8081">localhost:8081</a>, however, we see a browser error:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Warning] chmod(): Operation not permitted</span><br><span class="line">GET /dev/build</span><br><span class="line">Line 368 <span class="keyword">in</span> /var/www/html/vendor/league/flysystem/src/Adapter/Local.php</span><br></pre></td></tr></table></figure>

<p>This is a known problem, which can be easily fixed:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make chown</span><br><span class="line"><span class="comment"># docker-compose exec silverstripe chown -R 1000:1000 ./</span></span><br><span class="line"><span class="comment"># docker-compose exec silverstripe chown -R 33:33 ./public/</span></span><br></pre></td></tr></table></figure>

<p>As you can see from the output, the permissions are reset on the root folder (/app) to the id of the signed-in user and 33:33 (www-data:www-data) is given access to /app/public.</p>
<p>Refresh the webpage. The site will build!</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Environment Builder</span><br><span class="line">http:&#x2F;&#x2F;localhost:8081&#x2F;</span><br><span class="line">dev ‚Üí build</span><br><span class="line">Building database using SilverStripe\ORM\Connect\MySQL 5.7.31</span><br><span class="line">Creating database</span><br><span class="line"></span><br><span class="line">Creating database tables</span><br><span class="line">* File</span><br><span class="line">* Table File: created</span><br><span class="line">* Field File.ID: created as int(11) not null auto_increment</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>Navigate to <a href="http://localhost:8081/" target="_blank" rel="noopener">http://localhost:8081/</a> and the base site will display, or <a href="http://localhost:8081/admin" target="_blank" rel="noopener">http://localhost:8081/admin</a> and sign in to the CMS using the username and password set in the <strong>docker-compose.yml</strong>:</p>
<ul>
<li>SS_DEFAULT_ADMIN_USERNAME=<strong>admin</strong> </li>
<li>SS_DEFAULT_ADMIN_PASSWORD=<strong>password</strong></li>
</ul>
<p><img src="/2021/02/12/Troubleshooting-Docker/silverstripe-hello-world.png" alt="Hexo hello word demo" title="Hexo hello word demo"></p>
<h2 id="Node-Project"><a href="#Node-Project" class="headerlink" title="Node Project"></a>Node Project</h2><p>As promised at the start of the blog we will now create a node project, as the methods are the same as the Silverstripe project I will only explain the differences. We will use this Hexo static content generator as an example. I am running it now, with Docker.</p>
<h3 id="Create-a-new-project"><a href="#Create-a-new-project" class="headerlink" title="Create a new project"></a>Create a new project</h3><p>We will go through the <a href="https://hexo.io/docs/" target="_blank" rel="noopener">Hexo documentation</a> and convert it to a Docker environment:</p>
<h3 id="Requirements"><a href="#Requirements" class="headerlink" title="Requirements"></a>Requirements</h3><p>Installing Hexo is relatively easy and only requires the following beforehand:</p>
<ul>
<li>Node.js (Should be at least Node.js 10.13, recommends 12.0 or higher) <ul>
<li>We can use Docker</li>
</ul>
</li>
<li>Git <ul>
<li>We can use Docker </li>
</ul>
</li>
</ul>
<p>Install Hexo globally <code>npm install -g hexo-cli</code> or per project <code>npm install hexo</code> - This can be done inside a node container.</p>
<h3 id="Setup"><a href="#Setup" class="headerlink" title="Setup"></a>Setup</h3><p>The instructions are:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hexo init &lt;folder&gt;</span><br><span class="line"><span class="built_in">cd</span> &lt;folder&gt;</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure>

<h3 id="Docker-plan"><a href="#Docker-plan" class="headerlink" title="Docker plan"></a>Docker plan</h3><p>The setup has the same problem as Silverstripe. You need to install Hexo before you can <strong>init</strong> a project, the workaround is therefore similar. We need a node image, globally install hexo, init the project then we can cd to the project. Like Silverstripe we can:</p>
<ul>
<li>create the project</li>
<li>configure Docker to use node</li>
<li>Add Hexo globally</li>
<li>init the project in the current directory</li>
<li>Add Hexo as a project dependency</li>
<li>reset the permissions</li>
</ul>
<h3 id="Create-the-project"><a href="#Create-the-project" class="headerlink" title="Create the project"></a>Create the project</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd ~/PhpstormProjects/</span><br><span class="line">mkdir ./hexo-demo</span><br><span class="line">cd ./hexo-demo</span><br><span class="line">touch ./docker-compose.yml</span><br><span class="line">touch ./Makefile</span><br><span class="line">phpstorm .</span><br></pre></td></tr></table></figure>

<h3 id="Configure-Docker-to-use-node"><a href="#Configure-Docker-to-use-node" class="headerlink" title="Configure Docker to use node"></a>Configure Docker to use node</h3><p>We can now create the <strong>docker-compose.yml</strong> for Docker and <strong>Makefile</strong> files</p>
<p><strong>docker-compose.yml</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">'3'</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">server:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">node:12.18.4-alpine</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">yarn</span> <span class="string">server</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/app</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/app</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">"4000:4000"</span></span><br><span class="line">  <span class="attr">generate:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">node:12.18.4-alpine</span></span><br><span class="line">    <span class="attr">command:</span> <span class="string">yarn</span> <span class="string">build</span></span><br><span class="line">    <span class="attr">working_dir:</span> <span class="string">/app</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">.:/app</span></span><br></pre></td></tr></table></figure>

<p><strong>Makefile</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Set UID to your user ID. To check your user ID run `<span class="built_in">echo</span> $(id -u)`</span></span><br><span class="line">UID = 1000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> Usage:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> make up - starts the docker-compose <span class="keyword">in</span> the same directory <span class="keyword">in</span> demon (background)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make up<span class="_">-f</span> - start the docker-compose <span class="keyword">in</span> the foreground (useful <span class="keyword">for</span> error messages)</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make down - stops the docker-compose</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make server - same as make up</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make generate - runs hexo generate as the standard user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make build - <span class="built_in">alias</span> to make generate</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell - opens a shell terminal <span class="keyword">in</span> the running node container as a standard user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell-run - starts a new container as a standard user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell-root - opens a shell terminal <span class="keyword">in</span> the running node container as a root user</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> make shell-root-run - starts a new container as a root user </span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> make chown - runs chown, as the root user to reset the ownership of all folders to the UID</span></span><br><span class="line"></span><br><span class="line">up:</span><br><span class="line">	docker-compose up --build --remove-orphans -d server</span><br><span class="line">up-f:</span><br><span class="line">	docker-compose up --build --remove-orphans server</span><br><span class="line">down:</span><br><span class="line">	docker-compose down --remove-orphans</span><br><span class="line">server:</span><br><span class="line">	docker-compose up --build --remove-orphans -d server</span><br><span class="line">generate:</span><br><span class="line">	docker-compose run -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; --rm generate</span><br><span class="line">build:</span><br><span class="line">	docker-compose run -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; --rm generate</span><br><span class="line">hexo:</span><br><span class="line">	docker-compose exec -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; server npx hexo new $(new)</span><br><span class="line"></span><br><span class="line">shell:</span><br><span class="line">	docker-compose exec -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; server /bin/sh</span><br><span class="line">shell-root:</span><br><span class="line">	docker-compose exec -u 0:0 server /bin/sh</span><br><span class="line">shell-run:</span><br><span class="line">	docker-compose run -u $&#123;shell id -u&#125;:$&#123;shell id -g&#125; server /bin/sh</span><br><span class="line">shell-root-run:</span><br><span class="line">	docker-compose run -u 0:0 server /bin/sh</span><br><span class="line"></span><br><span class="line">chown:</span><br><span class="line">	docker-compose exec -u 0:0 server chown -R $&#123;shell id -u&#125;:$&#123;shell id -g&#125; ./</span><br></pre></td></tr></table></figure>

<p>You can see many similarities with the setup, even though they are completely different projects, the methods to start, stop and access are the same. This gives a consistent environment between projects.</p>
<p>You may be wondering why we are using node 12. As of Feb 2021, if you run Hexo with node 14, you will see an error: <a href="https://github.com/hexojs/hexo/issues/4257" target="_blank" rel="noopener">Regression in Node 14</a>, therefore the <strong>composer-compose.yml</strong> has been configured to use Node 12 until this is resolved. This is an excellent example of why Docker is so powerful, if Node 14, the LTS version, was locally installed this would be a problem!</p>
<h3 id="Add-Hexo-globally"><a href="#Add-Hexo-globally" class="headerlink" title="Add Hexo globally"></a>Add Hexo globally</h3><p>This is a temporary step, to allow the project to be initialised:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">make shell-root-run</span><br><span class="line"><span class="comment"># /app # </span></span><br><span class="line">whoami</span><br><span class="line"><span class="comment"># root</span></span><br><span class="line">npm install -g hexo-cli</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># + hexo-cli@4.2.0</span></span><br><span class="line"><span class="comment"># added 65 packages from 339 contributors in 4.852s</span></span><br></pre></td></tr></table></figure>

<p>Keep the node container running and open a new terminal</p>
<h3 id="init-the-project-in-the-current-directory"><a href="#init-the-project-in-the-current-directory" class="headerlink" title="init the project in the current directory"></a>init the project in the current directory</h3><p>With a new terminal open, we can exec in the same running container, except this time as a stand user, reducing the problem with file permissions.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line"><span class="meta">#</span><span class="bash"> CONTAINER ID        IMAGE                ...  NAMES</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> e6ce46b15845        node:12.18.4-alpine  ...  hexo-demo_server_run_2746d359d723</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> note the name of your server (hexo-demo_server_run_2746d359d723) and replace it below:</span></span><br><span class="line">docker exec -u $&#123;id -u&#125;:$&#123;id -g&#125; -it hexo-demo_server_run_2746d359d723 /bin/sh</span><br><span class="line"><span class="meta">#</span><span class="bash"> /app <span class="comment"># </span></span></span><br><span class="line">whoami</span><br><span class="line"><span class="meta">#</span><span class="bash"> node</span></span><br><span class="line">hexo init temp</span><br><span class="line"><span class="meta">#</span><span class="bash"> INFO  Cloning hexo-starter https://github.com/hexojs/hexo-starter.git</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> WARN  git <span class="built_in">clone</span> failed. Copying data instead</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> FATAL &#123;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ...</span></span><br></pre></td></tr></table></figure>

<p>Ok, so we need git! Good job the other terminal is still open and running as root. Switch terminals:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /app </span></span><br><span class="line">whoami</span><br><span class="line"><span class="comment"># root</span></span><br><span class="line">apk update &amp;&amp; apk add git</span><br><span class="line"><span class="comment"># ...</span></span><br><span class="line"><span class="comment"># (6/6) Installing git (2.24.3-r0)</span></span><br><span class="line"><span class="comment"># Executing busybox-1.31.1-r9.trigger</span></span><br><span class="line"><span class="comment"># Executing ca-certificates-20191127-r2.trigger</span></span><br><span class="line"><span class="comment"># OK: 23 MiB in 22 packages</span></span><br></pre></td></tr></table></figure>

<p>Now git has been installed in the running node container we can switch back to the stand node account and try again</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">whoami</span><br><span class="line"><span class="comment"># node</span></span><br><span class="line">hexo init temp</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">INFO  Cloning hexo-starter https:&#x2F;&#x2F;github.com&#x2F;hexojs&#x2F;hexo-starter.git</span><br><span class="line">INFO  Install dependencies</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; urix@0.1.0: Please ...</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve ...</span><br><span class="line">warning hexo-renderer-stylus &gt; stylus &gt; css-parse &gt; css &gt; source-map-resolve ...</span><br><span class="line">warning Your current version of Yarn is out of date. The latest version is ...</span><br><span class="line">INFO  Start blogging with Hexo!</span><br></pre></td></tr></table></figure>

<p>Next temp directory can be moved:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mv ./temp/* .</span><br><span class="line">ls -l</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">total 88</span><br><span class="line">-rw-rw-r--    1 node     node          1316 Feb 14 13:25 Makefile</span><br><span class="line">-rw-r--r--    1 node     node             0 Feb 14 14:19 _config.landscape.yml</span><br><span class="line">-rw-r--r--    1 node     node          2439 Feb 14 14:19 _config.yml</span><br><span class="line">-rw-rw-r--    1 node     node           287 Feb 14 11:32 docker-compose.yml</span><br><span class="line">drwxr-xr-x  166 node     node          4096 Feb 14 14:19 node_modules</span><br><span class="line">-rw-r--r--    1 node     node           615 Feb 14 14:19 package.json</span><br><span class="line">drwxr-xr-x    2 node     node          4096 Feb 14 14:19 scaffolds</span><br><span class="line">drwxr-xr-x    3 node     node          4096 Feb 14 14:19 source</span><br><span class="line">drwxr-xr-x    2 node     node          4096 Feb 14 14:21 temp</span><br><span class="line">drwxr-xr-x    2 node     node          4096 Feb 14 14:19 themes</span><br><span class="line">-rw-r--r--    1 node     node         52871 Feb 14 14:19 yarn.lock</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">/app $ </span></span><br><span class="line">ls -l temp</span><br><span class="line"><span class="meta">#</span><span class="bash">total 0</span></span><br></pre></td></tr></table></figure>

<p>The temp directory can be removed:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">rm -fr ./temp/</span><br><span class="line">ls -l</span><br><span class="line"><span class="comment"># check the temp directory has been removed</span></span><br><span class="line">yarn</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yarn install v1.22.4</span><br><span class="line">[1&#x2F;4] Resolving packages...</span><br><span class="line">[2&#x2F;4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform &quot;linux&quot; is incompatible with this module.</span><br><span class="line">info &quot;fsevents@2.3.2&quot; is an optional dependency and failed compatibility check. ...</span><br><span class="line">[3&#x2F;4] Linking dependencies...</span><br><span class="line">[4&#x2F;4] Building fresh packages...</span><br><span class="line">Done in 0.54s.</span><br></pre></td></tr></table></figure>

<h3 id="Add-Hexo-as-a-project-dependency"><a href="#Add-Hexo-as-a-project-dependency" class="headerlink" title="Add Hexo as a project dependency"></a>Add Hexo as a project dependency</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn add hexo</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">yarn add v1.22.4</span><br><span class="line">[1&#x2F;4] Resolving packages...</span><br><span class="line">[2&#x2F;4] Fetching packages...</span><br><span class="line">info fsevents@2.3.2: The platform &quot;linux&quot; is incompatible with this module.</span><br><span class="line">info &quot;fsevents@2.3.2&quot; is an optional dependency and failed compatibility check. ...</span><br><span class="line">[3&#x2F;4] Linking dependencies...</span><br><span class="line">[4&#x2F;4] Building fresh packages...</span><br><span class="line">success Saved lockfile.</span><br><span class="line">success Saved 1 new dependency.</span><br><span class="line">info Direct dependencies</span><br><span class="line">‚îî‚îÄ hexo@5.3.0</span><br><span class="line">info All dependencies</span><br><span class="line">‚îî‚îÄ hexo@5.3.0</span><br><span class="line">Done in 0.77s.</span><br></pre></td></tr></table></figure>

<p>Exit out of all the terminals.</p>
<h3 id="Reset-the-permissions"><a href="#Reset-the-permissions" class="headerlink" title="Reset the permissions"></a>Reset the permissions</h3><p>Open a new terminal:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br><span class="line"><span class="comment"># There should be no running containers</span></span><br><span class="line">make chown</span><br><span class="line"><span class="comment"># docker-compose exec -u 0:0 server chown -R 1000:1000 ./</span></span><br><span class="line">ls -l</span><br></pre></td></tr></table></figure>

<p>We installed hexo under our account, this was probably is an unnecessary step. All the files and folders are under my username and group: </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">total 104</span><br><span class="line">-rw-r--r--   1 michael michael     0 Feb 14 14:19 _config.landscape.yml</span><br><span class="line">-rw-r--r--   1 michael michael  2439 Feb 14 14:19 _config.yml</span><br><span class="line">-rw-r--r--   1 michael michael 19700 Feb 14 14:27 db.json</span><br><span class="line">-rw-rw-r--   1 michael michael   287 Feb 14 14:26 docker-compose.yml</span><br><span class="line">-rw-rw-r--   1 michael michael  1316 Feb 14 13:25 Makefile</span><br><span class="line">drwxr-xr-x 171 michael michael  4096 Feb 14 14:23 node_modules</span><br><span class="line">-rw-r--r--   1 michael michael   619 Feb 14 14:27 package.json</span><br><span class="line">drwxr-xr-x   2 michael michael  4096 Feb 14 14:19 scaffolds</span><br><span class="line">drwxr-xr-x   3 michael michael  4096 Feb 14 14:19 source</span><br><span class="line">drwxr-xr-x   2 michael michael  4096 Feb 14 14:19 themes</span><br><span class="line">-rw-r--r--   1 michael michael 52871 Feb 14 14:23 yarn.lock</span><br></pre></td></tr></table></figure>

<p>We can start the website</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">make up</span><br></pre></td></tr></table></figure>

<p>Open the browser to <a href="localhost:4000">localhost:4000</a>. The Hexo default page will open showing a Hello World blog post.</p>
<p><img src="/2021/02/12/Troubleshooting-Docker/hexo-demo.png" alt="Hexo hello word demo" title="Hexo hello word demo"></p>
<h2 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h2><p>Docker is a powerful development environment. By using the right image, extending them as required, they give us the required tools to do our job. </p>
<p>File permissions are the bain of Docker on Linux. Once we know how to run the containers, under the correct accounts and how to change the file and folder permissions, this problem is quickly overcome.</p>
<p>Using Dockerfile with <strong>docker-compose.yml</strong> and <strong>Makefile</strong>. The project environment becomes much easy to work with.</p>
<p>Edit: Replaced ${UID}:${UID} with ${shell id -u}:${shell id -g}</p>

  </article>
  <div class="random-toc-area">
  <button class="btn-hide-toc btn-hide-toc-show" style="display: none" onclick="TOCToggle()">Show TOC</button>
  <button class="btn-hide-toc btn-hide-toc-hide" onclick="TOCToggle()">Hide TOC</button>
  <div class="random-toc">
    <h2>Table of Content</h2>
    <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#So-what-is-the-blog-about"><span class="toc-text">So what is the blog about?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#File-permissions"><span class="toc-text">File permissions</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Composer-Docker-Image"><span class="toc-text">Composer Docker Image</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Basic-usage"><span class="toc-text">Basic usage</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Fixing-filesystem-permissions"><span class="toc-text">Fixing filesystem permissions</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-composer-programmatically"><span class="toc-text">Install composer programmatically</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Possible-workarounds"><span class="toc-text">Possible workarounds</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Troubleshooting-Composer"><span class="toc-text">Troubleshooting Composer</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Example-Dockerfile"><span class="toc-text">Example Dockerfile</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#How-to-create-a-project-from-within-a-Docker-container"><span class="toc-text">How to create a project from within a Docker container</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Node-Project"><span class="toc-text">Node Project</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-a-new-project"><span class="toc-text">Create a new project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Requirements"><span class="toc-text">Requirements</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Setup"><span class="toc-text">Setup</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Docker-plan"><span class="toc-text">Docker plan</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-the-project"><span class="toc-text">Create the project</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Configure-Docker-to-use-node"><span class="toc-text">Configure Docker to use node</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-Hexo-globally"><span class="toc-text">Add Hexo globally</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#init-the-project-in-the-current-directory"><span class="toc-text">init the project in the current directory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Add-Hexo-as-a-project-dependency"><span class="toc-text">Add Hexo as a project dependency</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Reset-the-permissions"><span class="toc-text">Reset the permissions</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summary"><span class="toc-text">Summary</span></a></li></ol>
  </div>
</div>

  
<nav id="pagination">
  
    <a href="/2021/05/23/Standard-setup-for-PHP-projects-2021/" class="prev">&larr; Prev post Standard setup for PHP projects 2021</a>
  

  

  
    <a href="/2020/10/10/Set-up-PhpStorm-to-use-PHP-with-PHPUnit-and-xDebug-in-Docker/" class="next">Next post Set up PhpStorm to use PHP with PHPUnit and xDebug in Docker &rarr;</a>
  
</nav>

  <!-- JiaThis Button BEGIN -->

<!-- JiaThis Button END -->


      
      
    </div>
  </div>

  <div id="bottom-outer">
    <div id="bottom-inner">
      Site by Pen y Fan using
      <a href="http://hexo.io" target="_blank" rel="noopener">Hexo</a> & <a href="https://github.com/stiekel/hexo-theme-random" target="_blank" rel="noopener">Random</a>
      <br>
      
    </div>
  </div>
</div>

</div>


<div id="user-card">
  <div class="center-field">
    <img class="avatar" src="https://avatars3.githubusercontent.com/u/40126936?s=400&amp;u=957f8c1cbfeeb61a853b9e28eb2968352a77cc79&amp;v=4" alt="Pen y Fan">
    <p id="description">Posts about my coding experiences, primarily for my learning path with PHP, good clean professional code.</p>
    <ul class="social-icon">
  
  
    <li>
      <a href="https://twitter.com/MikeAPritch" target="_blank" rel="noopener">
        
          <i class="icon iconfont twitter">&#xe600;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.linkedin.com/in/michael-pritchard-340b4520/" target="_blank" rel="noopener">
        
          <i class="icon iconfont linkedin">&#xe601;</i>
        
      </a>
    </li>
  
    <li>
      <a href="https://www.reddit.com/user/Pen-y-Fan" target="_blank" rel="noopener">
        
          R
        
      </a>
    </li>
  
    <li>
      <a href="https://github.com/pen-y-fan" target="_blank" rel="noopener">
        
          <i class="icon iconfont github">&#xe606;</i>
        
      </a>
    </li>
  
</ul>
  </div>
</div>


<div id="btn-view">Hide</div>

<script>
// is trigger analytics / tongji script
var isIgnoreHost = false;

if(window && window.location && window.location.host) {
  isIgnoreHost = ["localhost","127.0.0.1"].some(function(address){
    return 0 === window.location.host.indexOf(address);
  });
}

var isTriggerAnalytics = !( true && isIgnoreHost );

</script>




  
  
    <script src="/js/jquery-3.5.1.min.js"></script>
  
    <script src="/js/vegas.min.js"></script>
  
    <script src="/js/random.js"></script>
  
    <script src="/js/highlight.pack.js"></script>
  
    <script src="/js/jquery.mousewheel.pack.js"></script>
  
    <script src="/js/jquery.fancybox.pack.js"></script>
  
    <script src="/js/jquery.fancybox-thumbs.js"></script>
  
    <script src="/js/plyr.js"></script>
  

<script>

  // fancybox
  var backgroundImages = [];
  
  $('#post').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox') || $(this).parent().hasClass('fancybox-thumb')) return;
      var alt = this.alt || this.title;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'post' + i);
    });
  });
  $(".fancybox").fancybox();

var vegasConfig = {"preload¬≠Image":true,"transition":["flash"],"timer":true,"delay":60000,"shuffle":true,"count":12};
var unsplashConfig = {"gravity":"center"};
// is show background images
var turnoffBackgroundImage = false;




var backgroundColor = "34495E";

$(".fancybox-thumb").fancybox({
  prevEffect: 'none',
  nextEffect: 'none',
  helpers: {
    title: {
      type: 'outside'
    },
    thumbs: {
      width: 50,
      height: 50
    }
  }
});

// show video with plyr
$(".video-container iframe").each(function(i){
  var url = $(this).attr('src');
  var id = url.split('/').pop();
  var plyrContainer = document.createElement('div');
  plyrContainer.className = 'plyr';
  var plyrElement = document.createElement('div');
  plyrElement.dataset.videoId = id;
  switch(true) {
    case url.search('youtube.com') >= 0:
      plyrElement.dataset.type = 'youtube';
      break;
    case url.search('vimeo.com') >= 0:
      plyrElement.dataset.type = 'vimeo';
      break;
    default:
      return;
  };
  plyrContainer.appendChild(plyrElement);
  $(this).parent().html(plyrContainer);
});
plyr.setup('.plyr', {iconUrl: '/css/sprite.svg'});
</script>
</body>
</html>

